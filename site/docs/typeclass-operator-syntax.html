<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typeclass Operator Syntax - Parser Status - Cure Documentation</title>
    <meta name="description" content=" Summary">
    <link rel="icon" type="image/png" href="../media/logo-128x128.png">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/cure-theme.css">
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="nav-container">
            <div class="logo-section">
                <img src="../media/logo-128x128.png" alt="Cure Logo" class="logo">
                <div>
                    <h1 class="site-title">Cure</h1>
                    <p class="site-tagline">Verification-First Programming</p>
                </div>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../docs.html">Documentation</a></li>
                    <li><a href="../api/index.html">API Reference</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="doc-page">
        <div class="doc-nav">
            <a href="../docs.html">← Back to Documentation</a>
        </div>
        
        <h1 id="typeclass-operator-syntax-parser-status">Typeclass Operator Syntax - Parser Status</h1>
<h2 id="summary">Summary</h2>
<p>The parser now fully supports operator function definitions in typeclasses and instances. However, <strong>function types as type arguments must be parenthesized</strong>.</p>
<h2 id="status">Status ✅</h2>
<h3 id="completed">Completed</h3>
<ol>
<li><strong>Lexer</strong>: Added all Functor/Applicative/Monad operators (<code>&lt;$</code>, <code>$&gt;</code>, <code>&lt;*&gt;</code>, <code>*&gt;</code>, <code>&lt;*</code>, <code>&gt;&gt;=</code>, <code>&gt;&gt;</code>)</li>
<li><strong>Parser</strong>: Operator function definitions work with <code>def (op)(params)</code> syntax</li>
<li><strong>Precedence</strong>: Operators have proper precedence (Functor &gt; Applicative &gt; Monad)</li>
<li><strong>Codegen</strong>: Operators compile to BEAM code</li>
</ol>
<h3 id="syntax-requirements">Syntax Requirements</h3>
<h4 id="works-operator-definitions">✅ Works: Operator Definitions</h4>
<div class="codehilite"><pre><span></span><code><span class="nx">typeclass</span><span class="w"> </span><span class="nx">Functor</span><span class="p">(</span><span class="nx">F</span><span class="p">)</span><span class="w"> </span><span class="nx">do</span>
<span class="w">  </span><span class="nx">def</span><span class="w"> </span><span class="p">(&lt;</span><span class="err">$</span><span class="p">)(</span><span class="nx">value</span><span class="p">:</span><span class="w"> </span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">fb</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">B</span><span class="p">)):</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">A</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">...</span>
<span class="w">  </span><span class="nx">def</span><span class="w"> </span><span class="p">(</span><span class="err">$</span><span class="p">&gt;)(</span><span class="nx">fa</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">A</span><span class="p">),</span><span class="w"> </span><span class="nx">value</span><span class="p">:</span><span class="w"> </span><span class="nx">B</span><span class="p">):</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">...</span>
<span class="nx">end</span>
</code></pre></div>

<h4 id="doesnt-work-bare-function-types-in-type-arguments">❌ Doesn't Work: Bare Function Types in Type Arguments</h4>
<div class="codehilite"><pre><span></span><code><span class="nx">def</span><span class="w"> </span><span class="p">(&lt;</span><span class="o">*</span><span class="p">&gt;)(</span><span class="nx">ff</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">B</span><span class="p">),</span><span class="w"> </span><span class="nx">fa</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">A</span><span class="p">)):</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span>
<span class="err">#</span><span class="w">                  </span><span class="o">^^</span><span class="w"> </span><span class="nx">Parser</span><span class="w"> </span><span class="nx">sees</span><span class="w"> </span><span class="nx">this</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nx">marker</span>
</code></pre></div>

<h4 id="works-parenthesized-function-types">✅ Works: Parenthesized Function Types</h4>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;*&gt;</span><span class="p">)(</span><span class="n">ff</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">((</span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">)),</span><span class="w"> </span><span class="n">fa</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="cp">#                ^^^^^^^^ Extra parentheses make it unambiguous</span>
</code></pre></div>

<h2 id="the-problem">The Problem</h2>
<p>When parsing <code>F(A -&gt; B)</code>, the parser:<br />
1. Sees <code>F(</code><br />
2. Starts parsing type argument<br />
3. Parses <code>A</code> as a complete type<br />
4. Sees <code>-&gt;</code> and thinks it's the return type marker (end of parameters)<br />
5. Expects <code>)</code> to close the parameter list<br />
6. <strong>Error</strong>: Got <code>-&gt;</code> when expecting <code>)</code></p>
<h2 id="the-solution">The Solution</h2>
<p><strong>Parenthesize function types when they appear as type arguments:</strong></p>
<h3 id="before-doesnt-parse">Before (Doesn't Parse)</h3>
<div class="codehilite"><pre><span></span><code><span class="nx">typeclass</span><span class="w"> </span><span class="nx">Applicative</span><span class="p">(</span><span class="nx">F</span><span class="p">)</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">Functor</span><span class="p">(</span><span class="nx">F</span><span class="p">)</span><span class="w"> </span><span class="nx">do</span>
<span class="w">  </span><span class="nx">def</span><span class="w"> </span><span class="p">(&lt;</span><span class="o">*</span><span class="p">&gt;)(</span><span class="nx">ff</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">B</span><span class="p">),</span><span class="w"> </span><span class="nx">fa</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">A</span><span class="p">)):</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span>

<span class="w">  </span><span class="nx">def</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">&gt;)(</span><span class="nx">fa</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">A</span><span class="p">),</span><span class="w"> </span><span class="nx">fb</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">B</span><span class="p">)):</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">=</span>
<span class="w">    </span><span class="nx">map</span><span class="p">(</span><span class="kd">fn</span><span class="p">(</span><span class="nx">_</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kd">fn</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="nx">end</span><span class="p">,</span><span class="w"> </span><span class="nx">fa</span><span class="p">)</span><span class="w"> </span><span class="p">&lt;</span><span class="o">*</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">fb</span>

<span class="w">  </span><span class="nx">def</span><span class="w"> </span><span class="nx">lift2</span><span class="p">(</span><span class="nx">f</span><span class="p">:</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">B</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">C</span><span class="p">,</span><span class="w"> </span><span class="nx">fa</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">A</span><span class="p">),</span><span class="w"> </span><span class="nx">fb</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">B</span><span class="p">)):</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">C</span><span class="p">)</span><span class="w"> </span><span class="p">=</span>
<span class="w">    </span><span class="nx">map</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">fa</span><span class="p">)</span><span class="w"> </span><span class="p">&lt;</span><span class="o">*</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">fb</span>
<span class="nx">end</span>
</code></pre></div>

<h3 id="after-parses-correctly">After (Parses Correctly)</h3>
<div class="codehilite"><pre><span></span><code><span class="nx">typeclass</span><span class="w"> </span><span class="nx">Applicative</span><span class="p">(</span><span class="nx">F</span><span class="p">)</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">Functor</span><span class="p">(</span><span class="nx">F</span><span class="p">)</span><span class="w"> </span><span class="nx">do</span>
<span class="w">  </span><span class="nx">def</span><span class="w"> </span><span class="p">(&lt;</span><span class="o">*</span><span class="p">&gt;)(</span><span class="nx">ff</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">((</span><span class="nx">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">B</span><span class="p">)),</span><span class="w"> </span><span class="nx">fa</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">A</span><span class="p">)):</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span>
<span class="w">  </span><span class="err">#</span><span class="w">               </span><span class="o">^^^^^^^^^</span><span class="w"> </span><span class="nx">Parenthesized</span>

<span class="w">  </span><span class="nx">def</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="p">&gt;)(</span><span class="nx">fa</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">A</span><span class="p">),</span><span class="w"> </span><span class="nx">fb</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">B</span><span class="p">)):</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">B</span><span class="p">)</span><span class="w"> </span><span class="p">=</span>
<span class="w">    </span><span class="nx">map</span><span class="p">(</span><span class="kd">fn</span><span class="p">(</span><span class="nx">_</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kd">fn</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="nx">end</span><span class="p">,</span><span class="w"> </span><span class="nx">fa</span><span class="p">)</span><span class="w"> </span><span class="p">&lt;</span><span class="o">*</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">fb</span>

<span class="w">  </span><span class="nx">def</span><span class="w"> </span><span class="nx">lift2</span><span class="p">(</span><span class="nx">f</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">B</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">C</span><span class="p">),</span><span class="w"> </span><span class="nx">fa</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">A</span><span class="p">),</span><span class="w"> </span><span class="nx">fb</span><span class="p">:</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">B</span><span class="p">)):</span><span class="w"> </span><span class="nx">F</span><span class="p">(</span><span class="nx">C</span><span class="p">)</span><span class="w"> </span><span class="p">=</span>
<span class="w">    </span><span class="err">#</span><span class="w">          </span><span class="o">^^^^^^^^^^^^^^</span><span class="w"> </span><span class="nx">Also</span><span class="w"> </span><span class="nx">parenthesized</span>
<span class="w">    </span><span class="nx">map</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">fa</span><span class="p">)</span><span class="w"> </span><span class="p">&lt;</span><span class="o">*</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">fb</span>
<span class="nx">end</span>
</code></pre></div>

<h2 id="changes-needed-in-typeclass-spec-files">Changes Needed in Typeclass Spec Files</h2>
<h3 id="file-libtypeclass_spectypeclasscure">File: <code>lib/typeclass_spec/typeclass.cure</code></h3>
<h4 id="line-79">Line 79</h4>
<div class="codehilite"><pre><span></span><code><span class="cp"># Before:</span>
<span class="n">def</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">fa</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="cp"># After:</span>
<span class="n">def</span><span class="w"> </span><span class="nf">map</span><span class="p">(</span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">),</span><span class="w"> </span><span class="n">fa</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</code></pre></div>

<h4 id="line-98">Line 98</h4>
<div class="codehilite"><pre><span></span><code><span class="cp"># Before:</span>
<span class="n">def</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;*&gt;</span><span class="p">)(</span><span class="n">ff</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">),</span><span class="w"> </span><span class="n">fa</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="cp"># After:</span>
<span class="n">def</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;*&gt;</span><span class="p">)(</span><span class="n">ff</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">((</span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">)),</span><span class="w"> </span><span class="n">fa</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</code></pre></div>

<h4 id="line-107">Line 107</h4>
<div class="codehilite"><pre><span></span><code><span class="cp"># Before:</span>
<span class="n">def</span><span class="w"> </span><span class="n">lift2</span><span class="p">(</span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">fa</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="w"> </span><span class="n">fb</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">B</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>

<span class="cp"># After:</span>
<span class="n">def</span><span class="w"> </span><span class="n">lift2</span><span class="p">(</span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">),</span><span class="w"> </span><span class="n">fa</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="w"> </span><span class="n">fb</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">B</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">C</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
</code></pre></div>

<h4 id="line-119">Line 119</h4>
<div class="codehilite"><pre><span></span><code><span class="cp"># Before:</span>
<span class="n">def</span><span class="w"> </span><span class="n">bind</span><span class="p">(</span><span class="n">ma</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="w"> </span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

<span class="cp"># After:</span>
<span class="n">def</span><span class="w"> </span><span class="n">bind</span><span class="p">(</span><span class="n">ma</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="w"> </span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">)))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
</code></pre></div>

<h4 id="line-122">Line 122</h4>
<div class="codehilite"><pre><span></span><code><span class="cp"># Before:</span>
<span class="n">def</span><span class="w"> </span><span class="p">(</span><span class="o">&gt;&gt;=</span><span class="p">)(</span><span class="n">ma</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="w"> </span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bind</span><span class="p">(</span><span class="n">ma</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>

<span class="cp"># After:</span>
<span class="n">def</span><span class="w"> </span><span class="p">(</span><span class="o">&gt;&gt;=</span><span class="p">)(</span><span class="n">ma</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="w"> </span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">)))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bind</span><span class="p">(</span><span class="n">ma</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
</code></pre></div>

<h4 id="line-131">Line 131</h4>
<div class="codehilite"><pre><span></span><code><span class="cp"># Before:</span>
<span class="n">def</span><span class="w"> </span><span class="n">flatMap</span><span class="p">(</span><span class="n">ma</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="w"> </span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bind</span><span class="p">(</span><span class="n">ma</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>

<span class="cp"># After:</span>
<span class="n">def</span><span class="w"> </span><span class="n">flatMap</span><span class="p">(</span><span class="n">ma</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="w"> </span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">)))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bind</span><span class="p">(</span><span class="n">ma</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">)</span>
</code></pre></div>

<h4 id="line-151">Line 151</h4>
<div class="codehilite"><pre><span></span><code><span class="cp"># Before:</span>
<span class="n">def</span><span class="w"> </span><span class="n">mapM</span><span class="p">(</span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">),</span><span class="w"> </span><span class="n">xs</span><span class="o">:</span><span class="w"> </span><span class="n">List</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">List</span><span class="p">(</span><span class="n">B</span><span class="p">))</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">Monad</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>

<span class="cp"># After:</span>
<span class="n">def</span><span class="w"> </span><span class="n">mapM</span><span class="p">(</span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">)),</span><span class="w"> </span><span class="n">xs</span><span class="o">:</span><span class="w"> </span><span class="n">List</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">List</span><span class="p">(</span><span class="n">B</span><span class="p">))</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">Monad</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
</code></pre></div>

<h4 id="line-155">Line 155</h4>
<div class="codehilite"><pre><span></span><code><span class="cp"># Before:</span>
<span class="n">def</span><span class="w"> </span><span class="n">forM_</span><span class="p">(</span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">),</span><span class="w"> </span><span class="n">xs</span><span class="o">:</span><span class="w"> </span><span class="n">List</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">Monad</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>

<span class="cp"># After:</span>
<span class="n">def</span><span class="w"> </span><span class="n">forM_</span><span class="p">(</span><span class="n">f</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">B</span><span class="p">)),</span><span class="w"> </span><span class="n">xs</span><span class="o">:</span><span class="w"> </span><span class="n">List</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">Unit</span><span class="p">)</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">Monad</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
</code></pre></div>

<h4 id="line-175">Line 175</h4>
<div class="codehilite"><pre><span></span><code><span class="cp"># Before:</span>
<span class="n">def</span><span class="w"> </span><span class="n">filterM</span><span class="p">(</span><span class="n">p</span><span class="o">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">Bool</span><span class="p">),</span><span class="w"> </span><span class="n">xs</span><span class="o">:</span><span class="w"> </span><span class="n">List</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">List</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">Monad</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>

<span class="cp"># After:</span>
<span class="n">def</span><span class="w"> </span><span class="n">filterM</span><span class="p">(</span><span class="n">p</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">Bool</span><span class="p">)),</span><span class="w"> </span><span class="n">xs</span><span class="o">:</span><span class="w"> </span><span class="n">List</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">:</span><span class="w"> </span><span class="n">M</span><span class="p">(</span><span class="n">List</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="n">Monad</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
</code></pre></div>

<h2 id="why-not-fix-the-parser">Why Not Fix the Parser?</h2>
<p><strong>This is actually the correct behavior.</strong> The ambiguity is real:</p>
<div class="codehilite"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">Which</span><span class="w"> </span><span class="nx">interpretation</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">correct</span><span class="p">?</span>
<span class="nx">def</span><span class="w"> </span><span class="nx">foo</span><span class="p">(</span><span class="nx">x</span><span class="p">:</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">B</span><span class="p">)</span>

<span class="err">#</span><span class="w"> </span><span class="nx">Option</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nx">Parameter</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">B</span><span class="p">)</span>
<span class="nx">def</span><span class="w"> </span><span class="nx">foo</span><span class="p">(</span><span class="nx">x</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">B</span><span class="p">))</span>

<span class="err">#</span><span class="w"> </span><span class="nx">Option</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="nx">Parameter</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nx">A</span><span class="p">,</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="nx">B</span>
<span class="nx">def</span><span class="w"> </span><span class="nx">foo</span><span class="p">(</span><span class="nx">x</span><span class="p">:</span><span class="w"> </span><span class="nx">A</span><span class="p">):</span><span class="w"> </span><span class="nx">B</span>

<span class="err">#</span><span class="w"> </span><span class="nx">Without</span><span class="w"> </span><span class="nx">parentheses</span><span class="p">,</span><span class="w"> </span><span class="nx">Option</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">natural</span>
</code></pre></div>

<p>In most type systems with function types:<br />
- Haskell requires parentheses: <code>f :: (a -&gt; b) -&gt; c</code><br />
- OCaml requires parentheses: <code>val f : (a -&gt; b) -&gt; c</code><br />
- Scala requires parentheses: <code>def f(g: A =&gt; B): C</code></p>
<h2 id="alternative-parser-enhancement-future">Alternative: Parser Enhancement (Future)</h2>
<p>We <em>could</em> enhance the parser to understand context, but it adds complexity:</p>
<div class="codehilite"><pre><span></span><code><span class="c">% In parse_type, when inside type arguments:</span>
<span class="nf">parse_type_in_context</span><span class="p">(</span><span class="nv">State</span><span class="p">,</span><span class="w"> </span><span class="nv">Context</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nv">Context</span><span class="w"> </span><span class="k">of</span>
<span class="w">        </span><span class="n">inside_type_args</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="c">% Allow -&gt; as part of function type</span>
<span class="w">            </span><span class="n">parse_function_type</span><span class="p">(</span><span class="nv">State</span><span class="p">);</span>
<span class="w">        </span><span class="p">_</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="c">% Treat -&gt; as return type marker</span>
<span class="w">            </span><span class="n">parse_simple_type</span><span class="p">(</span><span class="nv">State</span><span class="p">)</span>
<span class="w">    </span><span class="k">end</span><span class="p">.</span>
</code></pre></div>

<p>This would require:<br />
1. Threading context through all type parsing functions<br />
2. Tracking parenthesis depth<br />
3. More complex lookahead logic</p>
<p><strong>Recommendation</strong>: Keep current behavior, require parentheses. It's clearer and matches industry standards.</p>
<h2 id="testing">Testing</h2>
<p>To verify your typeclass files parse correctly:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/home/am/Proyectos/Ammotion/cure

<span class="c1"># Test parsing</span>
erl<span class="w"> </span>-pa<span class="w"> </span>_build/ebin<span class="w"> </span>-noshell<span class="w"> </span>-eval<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;case cure_parser:parse_file(\&quot;lib/typeclass_spec/typeclass.cure\&quot;) of \</span>
<span class="s2">     {ok, AST} -&gt; io:format(\&quot;Success! ~p items~n\&quot;, [length(AST)]); \</span>
<span class="s2">     {error, {parse_error, R, L, C}} -&gt; io:format(\&quot;Error ~p:~p - ~p~n\&quot;, [L, C, R]) \</span>
<span class="s2">   end, halt(0).&quot;</span>
</code></pre></div>

<h2 id="next-steps">Next Steps</h2>
<ol>
<li>Update <code>lib/typeclass_spec/typeclass.cure</code> with parenthesized function types</li>
<li>Update other typeclass spec files similarly</li>
<li>Test parsing: All files should parse successfully</li>
<li>Move files to <code>lib/std/</code> once they parse</li>
<li>Full compilation will work once higher-kinded types are fully supported</li>
</ol>
<h2 id="summary_1">Summary</h2>
<ul>
<li>✅ Operator names work: <code>def (&lt;$)(...)</code></li>
<li>✅ Operator precedence works</li>
<li>✅ Typeclass/instance syntax works</li>
<li>⚠️  <strong>Function types as type arguments need parentheses</strong>: <code>F((A -&gt; B))</code> not <code>F(A -&gt; B)</code></li>
<li>This matches standard practice in Haskell, OCaml, Scala, etc.</li>
</ul>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Documentation</h4>
                <ul>
                    <li><a href="../docs.html">Getting Started</a></li>
                    <li><a href="language-spec.html">Language Specification</a></li>
                    <li><a href="type-system.html">Type System</a></li>
                    <li><a href="fsm-usage.html">FSM Guide</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>Reference</h4>
                <ul>
                    <li><a href="../api/index.html">API Reference</a></li>
                    <li><a href="std-summary.html">Standard Library</a></li>
                    <li><a href="feature-reference.html">Feature Reference</a></li>
                    <li><a href="cli-usage.html">CLI Usage</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>Resources</h4>
                <ul>
                    <li><a href="editor-setup.html">Editor Setup</a></li>
                    <li><a href="project-overview.html">Project Overview</a></li>
                    <li><a href="cure-ultimate-description.html">Ultimate Guide</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 Cure Programming Language. Verification-first programming for the BEAM.</p>
        </div>
    </footer>
    <!-- Syntax Highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script src="../js/cure-language.js"></script>
    <script>
        // Initialize highlight.js and highlight all code blocks
        hljs.highlightAll();
    </script>
</body>
</html>
