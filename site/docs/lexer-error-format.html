<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lexer Error Format - Cure Documentation</title>
    <meta name="description" content="This document describes the error format returned by the Cure lexer, including location information for all errors.">
    <link rel="icon" type="image/png" href="../media/logo-128x128.png">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/cure-theme.css">
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="nav-container">
            <div class="logo-section">
                <img src="../media/logo-128x128.png" alt="Cure Logo" class="logo">
                <div>
                    <h1 class="site-title">Cure</h1>
                    <p class="site-tagline">Verification-First Programming</p>
                </div>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../docs.html">Documentation</a></li>
                    <li><a href="../api/index.html">API Reference</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="doc-page">
        <div class="doc-nav">
            <a href="../docs.html">‚Üê Back to Documentation</a>
        </div>
        
        <h1 id="lexer-error-format">Lexer Error Format</h1>
<p>This document describes the error format returned by the Cure lexer, including location information for all errors.</p>
<h2 id="error-format">Error Format</h2>
<p>All lexer errors are returned in the following format:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">Reason</span><span class="p">,</span><span class="w"> </span><span class="nv">Line</span><span class="p">,</span><span class="w"> </span><span class="nv">Column</span><span class="p">}}</span>
</code></pre></div>

<p>Where:<br />
- <code>Reason</code> - Error reason (atom or tuple describing the error)<br />
- <code>Line</code> - Line number where error occurred (1-based integer)<br />
- <code>Column</code> - Column number where error occurred (1-based integer)</p>
<h2 id="error-types">Error Types</h2>
<h3 id="unexpected-character">Unexpected Character</h3>
<p>When an unrecognized character is encountered:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="n">unexpected_character</span><span class="p">,</span><span class="w"> </span><span class="nv">CodePoint</span><span class="p">},</span><span class="w"> </span><span class="nv">Line</span><span class="p">,</span><span class="w"> </span><span class="nv">Column</span><span class="p">}}</span>
</code></pre></div>

<ul>
<li><code>CodePoint</code> - Unicode codepoint of the unexpected character (integer)</li>
</ul>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">cure_lexer</span><span class="p">:</span><span class="nf">tokenize</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;test ‚Ä¶ fail&quot;</span><span class="o">&gt;&gt;</span><span class="p">).</span>
<span class="c">% =&gt; {error, {{unexpected_character, 8230}, 1, 6}}</span>
<span class="c">% 8230 = U+2026 (horizontal ellipsis)</span>
</code></pre></div>

<h3 id="invalid-utf-8">Invalid UTF-8</h3>
<p>When malformed UTF-8 is encountered:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="n">invalid_utf8</span><span class="p">,</span><span class="w"> </span><span class="nv">FirstByte</span><span class="p">},</span><span class="w"> </span><span class="nv">Line</span><span class="p">,</span><span class="w"> </span><span class="nv">Column</span><span class="p">}}</span>
</code></pre></div>

<ul>
<li><code>FirstByte</code> - The first byte of the invalid sequence</li>
</ul>
<h3 id="unterminated-string">Unterminated String</h3>
<p>When a string literal is not closed:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">unterminated_string</span><span class="p">,</span><span class="w"> </span><span class="nv">Line</span><span class="p">,</span><span class="w"> </span><span class="nv">Column</span><span class="p">}}</span>
</code></pre></div>

<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nn">cure_lexer</span><span class="p">:</span><span class="nf">tokenize</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;x = </span><span class="se">\&quot;</span><span class="s">hello&quot;</span><span class="o">&gt;&gt;</span><span class="p">).</span>
<span class="c">% =&gt; {error, {unterminated_string, 1, 13}}</span>
</code></pre></div>

<h3 id="unterminated-quoted-atom">Unterminated Quoted Atom</h3>
<p>When a quoted atom is not closed:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">unterminated_quoted_atom</span><span class="p">,</span><span class="w"> </span><span class="nv">Line</span><span class="p">,</span><span class="w"> </span><span class="nv">Column</span><span class="p">}}</span>
</code></pre></div>

<h3 id="unterminated-interpolation">Unterminated Interpolation</h3>
<p>When string interpolation <code>#{...}</code> is not properly closed:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">unterminated_interpolation</span><span class="p">,</span><span class="w"> </span><span class="nv">Line</span><span class="p">,</span><span class="w"> </span><span class="nv">Column</span><span class="p">}}</span>
</code></pre></div>

<h3 id="unterminated-charlist">Unterminated Charlist</h3>
<p>When a charlist literal (using Unicode quotes) is not closed:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="n">unterminated_charlist</span><span class="p">,</span><span class="w"> </span><span class="nv">Line</span><span class="p">,</span><span class="w"> </span><span class="nv">Column</span><span class="p">}}}</span>
</code></pre></div>

<h2 id="location-tracking">Location Tracking</h2>
<h3 id="line-numbers">Line Numbers</h3>
<ul>
<li>1-based indexing</li>
<li>Incremented on every newline character (<code>\n</code>)</li>
<li>Reset column to 1 after newline</li>
</ul>
<h3 id="column-numbers">Column Numbers</h3>
<ul>
<li>1-based indexing</li>
<li>Incremented for each character processed</li>
<li>Multi-byte UTF-8 characters count as 1 column</li>
<li>Reset to 1 at the start of each line</li>
</ul>
<h3 id="example-with-multi-line-code">Example with Multi-line Code</h3>
<div class="codehilite"><pre><span></span><code><span class="nv">Code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;line 1</span>
<span class="s">line 2</span>
<span class="s">x ‚Ä¶ y</span>
<span class="s">line 4&quot;</span><span class="o">&gt;&gt;</span><span class="p">.</span>

<span class="nn">cure_lexer</span><span class="p">:</span><span class="nf">tokenize</span><span class="p">(</span><span class="nv">Code</span><span class="p">).</span>
<span class="c">% =&gt; {error, {{unexpected_character, 8230}, 3, 3}}</span>
<span class="c">%    Line 3 (third line)</span>
<span class="c">%    Column 3 (after &quot;x &quot;)</span>
</code></pre></div>

<h2 id="utf-8-support">UTF-8 Support</h2>
<p>The lexer properly handles UTF-8 characters in error reporting:</p>
<h3 id="1-byte-ascii">1-byte (ASCII)</h3>
<div class="codehilite"><pre><span></span><code><span class="nn">cure_lexer</span><span class="p">:</span><span class="nf">tokenize</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;x $ y&quot;</span><span class="o">&gt;&gt;</span><span class="p">).</span>
<span class="c">% =&gt; {error, {{unexpected_character, 36}, 1, 3}}</span>
<span class="c">% 36 = U+0024 ($)</span>
</code></pre></div>

<h3 id="2-byte-utf-8">2-byte UTF-8</h3>
<div class="codehilite"><pre><span></span><code><span class="nn">cure_lexer</span><span class="p">:</span><span class="nf">tokenize</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;x ¬¢ y&quot;</span><span class="o">&gt;&gt;</span><span class="p">).</span>
<span class="c">% =&gt; {error, {{unexpected_character, 162}, 1, 3}}</span>
<span class="c">% 162 = U+00A2 (¬¢)</span>
</code></pre></div>

<h3 id="3-byte-utf-8">3-byte UTF-8</h3>
<div class="codehilite"><pre><span></span><code><span class="nn">cure_lexer</span><span class="p">:</span><span class="nf">tokenize</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;x ‚Ä¶ y&quot;</span><span class="o">&gt;&gt;</span><span class="p">).</span>
<span class="c">% =&gt; {error, {{unexpected_character, 8230}, 1, 3}}</span>
<span class="c">% 8230 = U+2026 (‚Ä¶)</span>
</code></pre></div>

<h3 id="4-byte-utf-8-emoji">4-byte UTF-8 (Emoji)</h3>
<div class="codehilite"><pre><span></span><code><span class="nn">cure_lexer</span><span class="p">:</span><span class="nf">tokenize</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;x üòÄ y&quot;</span><span class="o">&gt;&gt;</span><span class="p">).</span>
<span class="c">% =&gt; {error, {{unexpected_character, 128512}, 1, 3}}</span>
<span class="c">% 128512 = U+1F600 (üòÄ)</span>
</code></pre></div>

<h2 id="integration-with-lsp">Integration with LSP</h2>
<p>The LSP server uses the location information to create diagnostics with proper ranges:</p>
<div class="codehilite"><pre><span></span><code><span class="c">% Lexer error</span>
<span class="p">{</span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="n">unexpected_character</span><span class="p">,</span><span class="w"> </span><span class="mi">8230</span><span class="p">},</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">}}</span>

<span class="c">% Converted to LSP diagnostic</span>
<span class="p">#{</span>
<span class="w">    </span><span class="n">range</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">#{</span>
<span class="w">        </span><span class="n">start</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">#{</span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">character</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">},</span><span class="w">  </span><span class="c">% 0-based in LSP</span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">#{</span><span class="n">line</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">character</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">6</span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="n">severity</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="c">% Error</span>
<span class="w">    </span><span class="n">source</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;cure&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="w">    </span><span class="n">message</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;Unexpected character: ‚Ä¶ (U+2026)&quot;</span><span class="o">&gt;&gt;</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="testing-location-tracking">Testing Location Tracking</h2>
<p>To verify location tracking:</p>
<div class="codehilite"><pre><span></span><code><span class="c">% Test line tracking</span>
<span class="nn">cure_lexer</span><span class="p">:</span><span class="nf">tokenize</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;a</span><span class="se">\n</span><span class="s">b</span><span class="se">\n</span><span class="s">c ‚Ä¶ d&quot;</span><span class="o">&gt;&gt;</span><span class="p">).</span>
<span class="c">% =&gt; {error, {{unexpected_character, 8230}, 3, 3}}</span>

<span class="c">% Test column tracking  </span>
<span class="nn">cure_lexer</span><span class="p">:</span><span class="nf">tokenize</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;hello ‚Ä¶ world&quot;</span><span class="o">&gt;&gt;</span><span class="p">).</span>
<span class="c">% =&gt; {error, {{unexpected_character, 8230}, 1, 7}}</span>

<span class="c">% Test multi-byte at column 1</span>
<span class="nn">cure_lexer</span><span class="p">:</span><span class="nf">tokenize</span><span class="p">(</span><span class="o">&lt;&lt;</span><span class="s">&quot;‚Ä¶test&quot;</span><span class="o">&gt;&gt;</span><span class="p">).</span>
<span class="c">% =&gt; {error, {{unexpected_character, 8230}, 1, 1}}</span>
</code></pre></div>

<h2 id="summary">Summary</h2>
<p>‚úÖ <strong>All lexer errors include location information</strong><br />
‚úÖ <strong>Line and column are 1-based</strong><br />
‚úÖ <strong>UTF-8 characters properly decoded to codepoints</strong><br />
‚úÖ <strong>Location tracking accurate across newlines</strong><br />
‚úÖ <strong>Multi-byte UTF-8 counted as single column</strong><br />
‚úÖ <strong>LSP integration uses location for diagnostics</strong></p>
<p>The Cure lexer provides comprehensive location information for all errors, enabling precise error reporting in both command-line and IDE environments.</p>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Documentation</h4>
                <ul>
                    <li><a href="../docs.html">Getting Started</a></li>
                    <li><a href="language-spec.html">Language Specification</a></li>
                    <li><a href="type-system.html">Type System</a></li>
                    <li><a href="fsm-usage.html">FSM Guide</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>Reference</h4>
                <ul>
                    <li><a href="../api/index.html">API Reference</a></li>
                    <li><a href="std-summary.html">Standard Library</a></li>
                    <li><a href="feature-reference.html">Feature Reference</a></li>
                    <li><a href="cli-usage.html">CLI Usage</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>Resources</h4>
                <ul>
                    <li><a href="editor-setup.html">Editor Setup</a></li>
                    <li><a href="project-overview.html">Project Overview</a></li>
                    <li><a href="cure-ultimate-description.html">Ultimate Guide</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 Cure Programming Language. Verification-first programming for the BEAM.</p>
        </div>
    </footer>
    <!-- Syntax Highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script src="../js/cure-language.js"></script>
    <script>
        // Initialize highlight.js and highlight all code blocks
        hljs.highlightAll();
    </script>
</body>
</html>
