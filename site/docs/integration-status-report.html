<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cure Programming Language - Integration Status Report - Cure Documentation</title>
    <meta name="description" content="Date: 2025-11-19  
Version: 1.1  
Report Author: Development Team  
Status: Production-Ready for Core Features, Beta for Advanced Feat">
    <link rel="icon" type="image/png" href="../media/logo-128x128.png">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="nav-container">
            <div class="logo-section">
                <img src="../media/logo-128x128.png" alt="Cure Logo" class="logo">
                <div>
                    <h1 class="site-title">Cure</h1>
                    <p class="site-tagline">Verification-First Programming</p>
                </div>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../docs.html">Documentation</a></li>
                    <li><a href="../api/index.html">API Reference</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="doc-page">
        <div class="doc-nav">
            <a href="../docs.html">‚Üê Back to Documentation</a>
        </div>
        
        <h1 id="cure-programming-language-integration-status-report">Cure Programming Language - Integration Status Report</h1>
<h2 id="smt-solver-and-fsm-implementation">SMT-Solver and FSM Implementation</h2>
<p><strong>Date:</strong> 2025-11-19<br />
<strong>Version:</strong> 1.1<br />
<strong>Report Author:</strong> Development Team<br />
<strong>Status:</strong> Production-Ready for Core Features, Beta for Advanced Features</p>
<hr />
<h2 id="executive-summary">Executive Summary</h2>
<p>Both SMT-solver and FSM integrations in Cure are <strong>functional and production-ready</strong> for their core use cases, with clear roadmaps for enhanced features. This report documents the current status, limitations, and postponed features for both systems.</p>
<h3 id="overall-status">Overall Status</h3>
<ul>
<li>‚úÖ <strong>SMT Integration:</strong> Phase 1 Complete (35% total progress)</li>
<li>‚úÖ <strong>FSM Integration:</strong> Core Implementation Complete (85% total progress)</li>
<li>üü° <strong>Known Issues:</strong> 2 critical, 5 minor (documented below)</li>
<li>üìã <strong>Postponed Features:</strong> Clearly defined roadmap (Phases 2-5)</li>
</ul>
<hr />
<h2 id="part-1-smt-solver-integration">Part 1: SMT-Solver Integration</h2>
<h3 id="11-current-status-production-ready-for-basic-constraints">1.1 Current Status: PRODUCTION-READY FOR BASIC CONSTRAINTS</h3>
<h4 id="what-works-phase-1-100-complete">‚úÖ What Works (Phase 1 - 100% Complete)</h4>
<p><strong>Core Infrastructure:</strong><br />
- Z3 SMT solver process management via Erlang ports<br />
- Bi-directional communication with 5-second timeout<br />
- SMT-LIB query generation and execution<br />
- Model parsing for Int, Bool, Real types<br />
- Basic constraint solving (arithmetic, comparisons, logic)<br />
- Integration with type checker for <code>when</code> clauses</p>
<p><strong>Tested Capabilities:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c">% Example 1: Simple constraint solving</span>
<span class="nv">Constraint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span>
<span class="nv">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">cure_smt_solver</span><span class="p">:</span><span class="nf">solve_constraints</span><span class="p">([</span><span class="nv">Constraint</span><span class="p">],</span><span class="w"> </span><span class="p">#{</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">int</span><span class="p">})</span>
<span class="c">% =&gt; {sat, #{x =&gt; 6}}  % Z3 provides satisfying assignment</span>

<span class="c">% Example 2: Unsatisfiability detection</span>
<span class="nv">Constraints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="p">]</span>
<span class="nv">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">cure_smt_solver</span><span class="p">:</span><span class="nf">solve_constraints</span><span class="p">(</span><span class="nv">Constraints</span><span class="p">,</span><span class="w"> </span><span class="p">#{</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">int</span><span class="p">})</span>
<span class="c">% =&gt; unsat  % Correctly detects contradiction</span>
</code></pre></div>

<p><strong>Test Results:</strong><br />
- 23/23 tests passing (100%)<br />
- SMT Parser: 5/5 tests ‚úÖ<br />
- SMT Process: 7/7 tests ‚úÖ<br />
- SMT Solver Integration: 6/6 tests ‚úÖ<br />
- SMT Typechecker: 5/5 tests ‚úÖ</p>
<p><strong>Performance:</strong><br />
- Z3 startup: ~50ms<br />
- Simple constraint: ~10ms<br />
- Complex constraint: ~100ms<br />
- Model parsing: &lt;1ms<br />
- Query translation: &lt;1ms</p>
<p><strong>Supported SMT Theories:</strong><br />
- ‚úÖ QF_LIA (Linear Integer Arithmetic)<br />
- ‚úÖ QF_LRA (Linear Real Arithmetic)<br />
- ‚úÖ QF_LIRA (Mixed Int/Real)<br />
- ‚úÖ QF_NIA (Non-linear Integer Arithmetic - basic)</p>
<h3 id="12-limitations-and-postponed-features">1.2 Limitations and Postponed Features</h3>
<h4 id="phase-2-enhanced-constraint-translation-not-implemented">üü° Phase 2: Enhanced Constraint Translation (NOT IMPLEMENTED)</h4>
<p><strong>Missing Features:</strong><br />
1. <strong>Quantifiers</strong><br />
   - Universal quantification: <code>‚àÄx. P(x)</code><br />
   - Existential quantification: <code>‚àÉx. P(x)</code><br />
   - Bound variable handling</p>
<p><strong>Example Not Supported:</strong><br />
<code>cure
   type AllPositive(xs: List(Int)) = 
     forall i: Nat. i &lt; length(xs) =&gt; xs[i] &gt; 0
     # ^ Quantifiers not yet implemented</code></p>
<ol start="2">
<li>
<p><strong>Extended Operators</strong><br />
   - Modular arithmetic: <code>mod</code>, <code>abs</code><br />
   - Conditional expressions in constraints<br />
   - Let bindings within constraints</p>
</li>
<li>
<p><strong>Theory Extensions</strong><br />
   - Array theory (for list/vector constraints)<br />
   - Algebraic datatypes (for pattern constraints)<br />
   - String theory (for string constraints)<br />
   - Bit-vector theory (for low-level operations)</p>
</li>
</ol>
<p><strong>Workaround:</strong> Use explicit loop-based validation instead of quantified constraints.</p>
<p><strong>Estimated Time:</strong> 2-3 weeks for Phase 2 completion</p>
<h4 id="phase-3-deep-type-system-integration-partial">üü° Phase 3: Deep Type System Integration (PARTIAL)</h4>
<p><strong>Current Status:</strong><br />
- ‚úÖ Basic <code>when</code> clause processing<br />
- ‚ùå Refinement type subtyping<br />
- ‚ùå Dependent type verification via SMT<br />
- ‚ùå Automatic constraint inference</p>
<p><strong>Missing Capabilities:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">Example</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="nx">Refinement</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nx">subtyping</span><span class="w"> </span><span class="p">(</span><span class="nx">NOT</span><span class="w"> </span><span class="nx">SUPPORTED</span><span class="p">)</span>
<span class="k">type</span><span class="w"> </span><span class="nx">Positive</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Int</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="k">type</span><span class="w"> </span><span class="nx">NonZero</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Int</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">safe_div</span><span class="p">(</span><span class="nx">a</span><span class="p">:</span><span class="w"> </span><span class="nx">Int</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">:</span><span class="w"> </span><span class="nx">NonZero</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">Int</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">caller</span><span class="p">(</span><span class="nx">x</span><span class="p">:</span><span class="w"> </span><span class="nx">Positive</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">Int</span><span class="w"> </span><span class="p">=</span>
<span class="w">  </span><span class="nx">safe_div</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">Should</span><span class="w"> </span><span class="kt">auto</span><span class="o">-</span><span class="nx">prove</span><span class="p">:</span><span class="w"> </span><span class="nx">Positive</span><span class="w"> </span><span class="p">&lt;:</span><span class="w"> </span><span class="nx">NonZero</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">proof</span><span class="w"> </span><span class="nx">doesn</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">happen</span><span class="w"> </span><span class="nx">automatically</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">Example</span><span class="w"> </span><span class="mi">2</span><span class="err">:</span><span class="w"> </span><span class="n">Dependent</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">verification</span><span class="w"> </span><span class="p">(</span><span class="ow">NOT</span><span class="w"> </span><span class="n">SUPPORTED</span><span class="p">)</span>
<span class="n">type</span><span class="w"> </span><span class="n">Vector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="nl">n</span><span class="p">:</span><span class="w"> </span><span class="n">Nat</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>

<span class="n">def</span><span class="w"> </span><span class="n">safe_index</span><span class="p">(</span><span class="nl">v</span><span class="p">:</span><span class="w"> </span><span class="n">Vector</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="nl">i</span><span class="p">:</span><span class="w"> </span><span class="n">Nat</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">v</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Should</span><span class="w"> </span><span class="nl">verify</span><span class="p">:</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="nc">time</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="n">Dependent</span><span class="w"> </span><span class="k">constraint</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">verified</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">SMT</span>
</code></pre></div>

<p><strong>Workaround:</strong> Add explicit runtime checks or use guards.</p>
<p><strong>Estimated Time:</strong> 3-4 weeks for Phase 3 completion</p>
<h4 id="phase-4-lsp-real-time-verification-framework-only">üü° Phase 4: LSP Real-Time Verification (FRAMEWORK ONLY)</h4>
<p><strong>Current Status:</strong><br />
- ‚úÖ LSP module exists (<code>lsp/cure_lsp_smt.erl</code>)<br />
- ‚úÖ Constraint extraction framework<br />
- ‚ùå Incremental solving<br />
- ‚ùå Result caching<br />
- ‚ùå Rich diagnostics with counterexamples<br />
- ‚ùå Quick fixes</p>
<p><strong>Missing Capabilities:</strong><br />
- Real-time constraint verification in editor<br />
- Inline display of counterexamples<br />
- Suggested fixes for constraint violations<br />
- Performance optimization for large files</p>
<p><strong>Workaround:</strong> Run full compilation to get constraint errors.</p>
<p><strong>Estimated Time:</strong> 2-3 weeks for Phase 4 completion</p>
<h4 id="phase-5-advanced-features-stubs-only">üü° Phase 5: Advanced Features (STUBS ONLY)</h4>
<p><strong>Planned Features (Not Implemented):</strong><br />
1. <strong>Pattern Exhaustiveness via SMT</strong><br />
   - Prove pattern matching covers all cases<br />
   - Suggest missing patterns</p>
<ol start="2">
<li>
<p><strong>FSM Verification</strong><br />
   - Deadlock detection<br />
   - Liveness property checking<br />
   - Reachability analysis</p>
</li>
<li>
<p><strong>Guard Optimization</strong><br />
   - Eliminate redundant guards<br />
   - Reorder guards for performance</p>
</li>
<li>
<p><strong>Constraint Synthesis</strong><br />
   - Generate constraints from examples<br />
   - Infer refinement types</p>
</li>
</ol>
<p><strong>Estimated Time:</strong> 4-6 weeks for Phase 5 completion</p>
<h3 id="13-known-issues">1.3 Known Issues</h3>
<h4 id="issue-1-smt-not-exposed-in-cli">Issue #1: SMT Not Exposed in CLI</h4>
<p><strong>Status:</strong> üî¥ CRITICAL<br />
<strong>Impact:</strong> Users cannot easily enable/disable SMT solving</p>
<p><strong>Problem:</strong></p>
<div class="codehilite"><pre><span></span><code>./cure<span class="w"> </span>myfile.cure<span class="w">  </span><span class="c1"># SMT solver runs automatically</span>
<span class="c1"># No --smt-solver, --no-smt, or --smt-timeout flags</span>
</code></pre></div>

<p><strong>Workaround:</strong> SMT is always enabled if Z3 is installed. To disable, unset the Z3 path or modify source.</p>
<p><strong>Fix Needed:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Proposed CLI flags</span>
./cure<span class="w"> </span>myfile.cure<span class="w"> </span>--no-smt<span class="w">              </span><span class="c1"># Disable SMT</span>
./cure<span class="w"> </span>myfile.cure<span class="w"> </span>--smt-timeout<span class="w"> </span><span class="m">10000</span><span class="w">   </span><span class="c1"># 10 second timeout</span>
./cure<span class="w"> </span>myfile.cure<span class="w"> </span>--smt-solver<span class="w"> </span>cvc5<span class="w">     </span><span class="c1"># Use CVC5 instead of Z3</span>
</code></pre></div>

<p><strong>Files to Modify:</strong> <code>src/cure_cli.erl</code></p>
<p><strong>Estimated Time:</strong> 1-2 days</p>
<h4 id="issue-2-limited-error-messages">Issue #2: Limited Error Messages</h4>
<p><strong>Status:</strong> üü° MINOR<br />
<strong>Impact:</strong> SMT failures don't provide helpful diagnostics</p>
<p><strong>Problem:</strong><br />
When SMT solver times out or fails, error message is generic:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Error</span><span class="o">:</span><span class="w"> </span><span class="n">Constraint</span><span class="w"> </span><span class="n">solving</span><span class="w"> </span><span class="n">failed</span>
</code></pre></div>

<p><strong>Should Be:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">Error</span><span class="p">:</span><span class="w"> </span><span class="nx">SMT</span><span class="w"> </span><span class="nx">solver</span><span class="w"> </span><span class="nx">timeout</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="mi">5000</span><span class="nx">ms</span>
<span class="nx">Constraint</span><span class="p">:</span><span class="w"> </span><span class="k">forall</span><span class="w"> </span><span class="nx">x</span><span class="p">.</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="nx">Hint</span><span class="p">:</span><span class="w"> </span><span class="nx">Try</span><span class="w"> </span><span class="nx">simplifying</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="kd">constraint</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">increasing</span><span class="w"> </span><span class="nx">timeout</span>
</code></pre></div>

<p><strong>Workaround:</strong> Check compiler debug output with verbose mode.</p>
<p><strong>Estimated Time:</strong> 2-3 days</p>
<h3 id="14-documentation-status">1.4 Documentation Status</h3>
<p><strong>Existing Documentation:</strong><br />
- ‚úÖ Module documentation (API reference)<br />
- ‚úÖ Test examples<br />
- ‚úÖ Architecture overview<br />
- ‚ùå User guide (missing)<br />
- ‚ùå Tutorial (missing)<br />
- ‚ùå Best practices (missing)<br />
- ‚ùå Troubleshooting guide (missing)</p>
<p><strong>Action Items:</strong><br />
1. Create <code>docs/SMT_USER_GUIDE.md</code><br />
2. Add examples to <code>examples/smt_*.cure</code><br />
3. Write troubleshooting section<br />
4. Document performance tuning</p>
<h3 id="15-overall-smt-progress">1.5 Overall SMT Progress</h3>
<p><strong>Progress Breakdown:</strong><br />
- Phase 1 (Core): ‚úÖ 100% (4-5 weeks of work)<br />
- Phase 2 (Enhanced): ‚¨ú 0% (2-3 weeks estimated)<br />
- Phase 3 (Type System): üü° 15% (3-4 weeks estimated)<br />
- Phase 4 (LSP): üü° 10% (2-3 weeks estimated)<br />
- Phase 5 (Advanced): ‚¨ú 0% (4-6 weeks estimated)</p>
<p><strong>Total Progress:</strong> ~35% complete<br />
<strong>Total Estimated Time to 100%:</strong> 11-16 weeks from now</p>
<hr />
<h2 id="part-2-fsm-integration">Part 2: FSM Integration</h2>
<h3 id="21-current-status-production-ready-for-core-fsm-use-cases">2.1 Current Status: PRODUCTION-READY FOR CORE FSM USE CASES</h3>
<h4 id="what-works-85-complete">‚úÖ What Works (85% Complete)</h4>
<p><strong>FSM Definition and Compilation:</strong><br />
- ‚úÖ Arrow-based transition syntax (<code>State1 --&gt; |event| State2</code>)<br />
- ‚úÖ FSM payload records with typed fields<br />
- ‚úÖ Transition actions with state updates<br />
- ‚úÖ Multiple states per FSM<br />
- ‚úÖ Event handling with pattern matching<br />
- ‚úÖ FSM type checking and validation<br />
- ‚úÖ BEAM code generation for FSMs<br />
- ‚úÖ FSM runtime (gen_server-based)</p>
<p><strong>FSM Operations:</strong><br />
- ‚úÖ <code>fsm_spawn/2</code> - Create FSM instance<br />
- ‚úÖ <code>fsm_cast/2</code> - Send events (async)<br />
- ‚úÖ <code>fsm_advertise/2</code> - Register FSM by name<br />
- ‚úÖ <code>fsm_state/1</code> - Query current state<br />
- ‚úÖ <code>fsm_stop/1</code> - Terminate FSM<br />
- ‚úÖ <code>fsm_info/1</code> - Get FSM metadata<br />
- ‚úÖ <code>fsm_is_alive/1</code> - Check if FSM running<br />
- ‚úÖ <code>fsm_whereis/1</code> - Look up FSM by name<br />
- ‚úÖ <code>fsm_history/1</code> - Get event history<br />
- ‚úÖ <code>fsm_send_batch/2</code> - Batch event processing</p>
<p><strong>Standard Library Integration:</strong><br />
- ‚úÖ <code>lib/std/fsm.cure</code> - Complete FSM API<br />
- ‚úÖ <code>lib/std/system.cure</code> - System utilities (sleep, etc.)<br />
- ‚úÖ Type-checked FFI via <code>curify</code> keyword<br />
- ‚úÖ Proper error handling with Result types</p>
<p><strong>Examples:</strong><br />
- ‚úÖ <code>06_fsm_traffic_light.cure</code> - Basic FSM (WORKING)<br />
- ‚úÖ <code>06_fsm_traffic_light_enhanced.cure</code> - Advanced FSM (WORKING)<br />
- ‚ùå <code>07_fsm_verification.cure</code> - Multiple FSMs (BROKEN - see below)</p>
<p><strong>Testing:</strong><br />
- FSM runtime tests: ‚úÖ Passing<br />
- FSM compilation tests: ‚úÖ Passing<br />
- End-to-end examples: ‚úÖ 2/3 working</p>
<h3 id="22-limitations-and-known-issues">2.2 Limitations and Known Issues</h3>
<h4 id="issue-1-fsm-registration-must-be-manual">Issue #1: FSM Registration Must Be Manual</h4>
<p><strong>Status:</strong> üî¥ CRITICAL (BY DESIGN)<br />
<strong>Impact:</strong> Users must explicitly call <code>register_fsms()</code> before using FSMs</p>
<p><strong>Background:</strong><br />
The <code>on_load</code> hook was disabled because:<br />
1. ETS table ownership issue (on_load process is temporary)<br />
2. Table gets deleted when process exits<br />
3. {heir, none} doesn't prevent deletion (counterintuitive!)</p>
<p><strong>Current Requirement:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c">% When running from shell</span>
<span class="n">erl</span><span class="w"> </span><span class="o">-</span><span class="n">pa</span><span class="w"> </span><span class="p">_</span><span class="n">build</span><span class="o">/</span><span class="n">ebin</span><span class="w"> </span><span class="o">-</span><span class="n">eval</span><span class="w"> </span><span class="s">&quot;</span>
<span class="s">&#39;MyModule&#39;:register_fsms(),</span>
<span class="s">&#39;MyModule&#39;:main().</span>
<span class="s">&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="n">stop</span>
</code></pre></div>

<p><strong>In Cure Code:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="p">#</span><span class="w"> </span><span class="n">Cannot</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">register_fsms</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">Erlang</span><span class="w"> </span><span class="k">function</span><span class="o">:</span>
<span class="n">def</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">Int</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">register_fsms</span><span class="p">()</span><span class="w">  </span><span class="p">#</span><span class="w"> </span><span class="nl">ERROR:</span><span class="w"> </span><span class="n">Not</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">scope</span>
<span class="w">  </span><span class="p">...</span>
</code></pre></div>

<p><strong>Workaround #1:</strong> Use shell script:</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>
./cure<span class="w"> </span>examples/myfsm.cure
erl<span class="w"> </span>-pa<span class="w"> </span>_build/ebin<span class="w"> </span>-eval<span class="w"> </span><span class="s2">&quot;&#39;MyModule&#39;:register_fsms(), &#39;MyModule&#39;:main().&quot;</span><span class="w"> </span>-s<span class="w"> </span>init<span class="w"> </span>stop
</code></pre></div>

<p><strong>Workaround #2:</strong> Start application supervisor (for production):</p>
<div class="codehilite"><pre><span></span><code><span class="c">% In application startup</span>
<span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">my_app</span><span class="p">).</span>
<span class="p">-</span><span class="ni">behaviour</span><span class="p">(</span><span class="n">application</span><span class="p">).</span>

<span class="nf">start</span><span class="p">(_</span><span class="nv">Type</span><span class="p">,</span><span class="w"> </span><span class="p">_</span><span class="nv">Args</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="nn">&#39;MyModule&#39;</span><span class="p">:</span><span class="nf">register_fsms</span><span class="p">(),</span>
<span class="w">    </span><span class="nn">my_app_sup</span><span class="p">:</span><span class="nf">start_link</span><span class="p">().</span>
</code></pre></div>

<p><strong>Future Fix Options:</strong><br />
1. Create FSM registry application/supervisor<br />
2. Transfer ETS ownership to persistent process<br />
3. Use global named process for registry<br />
4. Implement module initialization callback</p>
<p><strong>Estimated Time:</strong> 2-3 days for proper fix</p>
<h4 id="issue-2-multiple-fsms-per-module-not-supported">Issue #2: Multiple FSMs Per Module Not Supported</h4>
<p><strong>Status:</strong> üî¥ CRITICAL<br />
<strong>Impact:</strong> Complex examples with multiple FSM types fail type checking</p>
<p><strong>Problem:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">module</span> <span class="n">ComplexFSMs</span> <span class="nb">do</span>
  <span class="c1"># FSM 1</span>
  <span class="n">fsm</span> <span class="n">CounterState</span> {...} <span class="nb">do</span> ... <span class="nb">end</span>

  <span class="c1"># FSM 2</span>
  <span class="n">fsm</span> <span class="n">LightState</span> {...} <span class="nb">do</span> ... <span class="nb">end</span>

  <span class="c1"># FSM 3</span>
  <span class="n">fsm</span> <span class="n">WorkflowState</span> {...} <span class="nb">do</span> ... <span class="nb">end</span>

  <span class="n">def</span> <span class="n">main</span>(): <span class="nb">Int</span> =
    <span class="k">let</span> <span class="n">counter</span> = <span class="n">fsm_spawn</span>(:<span class="n">CounterState</span>, ...)
    <span class="k">let</span> <span class="n">light</span> = <span class="n">fsm_spawn</span>(:<span class="n">LightState</span>, ...)
    <span class="c1"># ^ Type checker fails: loses track of bindings</span>
    ...
</code></pre></div>

<p><strong>Error:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Type</span><span class="w"> </span><span class="n">Checking</span><span class="w"> </span><span class="n">failed</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type_check_failed</span><span class="p">,</span>
<span class="w">    </span><span class="p">{</span><span class="n">inference_failed</span><span class="p">,</span>
<span class="w">        </span><span class="p">{</span><span class="n">unbound_variable</span><span class="p">,</span><span class="w"> </span><span class="n">counter_fsm</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">location</span><span class="p">,</span><span class="mi">135</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="n">undefined</span><span class="p">}}}}</span>
</code></pre></div>

<p><strong>Root Cause:</strong><br />
Type inference has difficulty with:<br />
- Multiple FSM type definitions in one module<br />
- Long functions (170+ lines) with many let bindings<br />
- Complex variable scoping in the presence of FSMs</p>
<p><strong>Workaround:</strong> Split into separate modules (one FSM per module)</p>
<p><strong>Example:</strong> <code>07_fsm_verification.cure</code> documented in <code>07_FSM_VERIFICATION_KNOWN_ISSUE.md</code></p>
<p><strong>Estimated Time:</strong> 1-2 weeks to fix type inference</p>
<h4 id="issue-3-no-fsm-verification-tools">Issue #3: No FSM Verification Tools</h4>
<p><strong>Status:</strong> üü° MINOR (PLANNED FEATURE)<br />
<strong>Impact:</strong> Cannot prove FSM properties (deadlock-freedom, reachability, etc.)</p>
<p><strong>Missing Capabilities:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">Desired</span><span class="w"> </span><span class="nx">but</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">implemented</span><span class="p">:</span>
<span class="nx">fsm</span><span class="w"> </span><span class="nx">TrafficLight</span><span class="w"> </span><span class="p">{</span><span class="o">...</span><span class="p">}</span><span class="w"> </span><span class="nx">do</span>
<span class="w">  </span><span class="nx">states</span><span class="w"> </span><span class="p">[</span><span class="nx">Green</span><span class="p">,</span><span class="w"> </span><span class="nx">Yellow</span><span class="p">,</span><span class="w"> </span><span class="nx">Red</span><span class="p">]</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">Would</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">verify</span><span class="p">:</span>
<span class="w">  </span><span class="nx">verify</span><span class="w"> </span><span class="nx">deadlock_free</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">no</span><span class="w"> </span><span class="nx">outgoing</span><span class="w"> </span><span class="nx">transitions</span>
<span class="w">  </span><span class="nx">verify</span><span class="w"> </span><span class="nx">all_reachable</span><span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="nx">All</span><span class="w"> </span><span class="nx">states</span><span class="w"> </span><span class="nx">reachable</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">initial</span>
<span class="w">  </span><span class="nx">verify</span><span class="w"> </span><span class="nx">cyclic</span><span class="w">          </span><span class="err">#</span><span class="w"> </span><span class="nx">Can</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">initial</span><span class="w"> </span><span class="nx">state</span>
<span class="nx">end</span>
</code></pre></div>

<p><strong>Current Status:</strong> Must manually inspect FSM definitions</p>
<p><strong>Related:</strong> SMT Phase 5 includes FSM verification via model checking</p>
<p><strong>Estimated Time:</strong> 3-4 weeks (depends on SMT Phase 5)</p>
<h4 id="issue-4-limited-fsm-timeout-support">Issue #4: Limited FSM Timeout Support</h4>
<p><strong>Status:</strong> üü° MINOR<br />
<strong>Impact:</strong> Timeout transitions work but lack scheduling flexibility</p>
<p><strong>Current Support:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">fsm</span><span class="w"> </span><span class="n">MyFSM</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">State1</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timeout</span><span class="o">|</span><span class="w"> </span><span class="n">State2</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="mi">5000</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Fixed</span><span class="w"> </span><span class="mi">5</span><span class="o">-</span><span class="n">second</span><span class="w"> </span><span class="n">timeout</span>
<span class="kd">end</span>
</code></pre></div>

<p><strong>Missing:</strong><br />
- Dynamic timeouts based on state data<br />
- Timeout cancellation<br />
- Multiple concurrent timeouts<br />
- Timeout priority/ordering</p>
<p><strong>Workaround:</strong> Use external timer process and send timeout events manually</p>
<p><strong>Estimated Time:</strong> 1-2 weeks</p>
<h4 id="issue-5-fsm-hot-code-reloading">Issue #5: FSM Hot Code Reloading</h4>
<p><strong>Status:</strong> üü° MINOR<br />
<strong>Impact:</strong> FSM processes don't automatically upgrade on code reload</p>
<p><strong>Problem:</strong><br />
When recompiling a module with FSM definitions:<br />
1. Old FSM processes keep running old code<br />
2. No automatic migration of FSM state<br />
3. Must manually restart all FSM instances</p>
<p><strong>Workaround:</strong> </p>
<div class="codehilite"><pre><span></span><code><span class="c">% Manually stop and restart FSMs</span>
<span class="nf">fsm_stop</span><span class="p">(</span><span class="nv">OldPid</span><span class="p">),</span>
<span class="nv">NewPid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fsm_spawn</span><span class="p">(...).</span>
</code></pre></div>

<p><strong>Future Enhancement:</strong> Implement FSM upgrade callbacks</p>
<p><strong>Estimated Time:</strong> 2-3 weeks</p>
<h3 id="23-postponed-features">2.3 Postponed Features</h3>
<h4 id="feature-1-fsm-composition">Feature #1: FSM Composition</h4>
<p><strong>Status:</strong> PLANNED (Not in current roadmap)</p>
<p><strong>Concept:</strong></p>
<div class="codehilite"><pre><span></span><code># Combine FSMs into hierarchical/concurrent structures
fsm CompositeSystem =
  parallel(
    TrafficLight,
    PedestrianSignal,
    EmergencyOverride
  )
</code></pre></div>

<p><strong>Use Cases:</strong><br />
- Hierarchical state machines<br />
- Concurrent FSM coordination<br />
- FSM inheritance/delegation</p>
<p><strong>Estimated Time:</strong> 3-4 weeks</p>
<h4 id="feature-2-fsm-visual-tools">Feature #2: FSM Visual Tools</h4>
<p><strong>Status:</strong> PLANNED (Not in current roadmap)</p>
<p><strong>Desired Tools:</strong><br />
- FSM diagram generation (Mermaid/GraphViz)<br />
- Interactive FSM debugger<br />
- FSM simulation/testing UI<br />
- State transition visualizer</p>
<p><strong>Current Status:</strong> Must use external tools</p>
<p><strong>Estimated Time:</strong> 4-6 weeks</p>
<h4 id="feature-3-fsm-performance-monitoring">Feature #3: FSM Performance Monitoring</h4>
<p><strong>Status:</strong> PARTIAL (Framework exists)</p>
<p><strong>Current Support:</strong><br />
- Basic event counters<br />
- State history (last N events)</p>
<p><strong>Missing:</strong><br />
- Detailed performance metrics<br />
- Event processing latency<br />
- State dwell time<br />
- Transition frequency<br />
- Memory usage tracking</p>
<p><strong>Workaround:</strong> Use Erlang's <code>:observer</code> application</p>
<p><strong>Estimated Time:</strong> 2-3 weeks</p>
<h3 id="24-documentation-status">2.4 Documentation Status</h3>
<p><strong>Existing Documentation:</strong><br />
- ‚úÖ FSM syntax guide<br />
- ‚úÖ API reference<br />
- ‚úÖ Working examples (2)<br />
- ‚úÖ Integration guide<br />
- ‚úÖ Known issues (this document)<br />
- ‚ùå FSM best practices (missing)<br />
- ‚ùå Performance tuning (missing)<br />
- ‚ùå Production deployment guide (missing)</p>
<h3 id="25-overall-fsm-progress">2.5 Overall FSM Progress</h3>
<p><strong>Progress Breakdown:</strong><br />
- Core Implementation: ‚úÖ 100%<br />
- Standard Library: ‚úÖ 100%<br />
- Examples: ‚úÖ 67% (2/3 working)<br />
- Type System: üü° 90% (multiple FSMs issue)<br />
- Verification Tools: ‚¨ú 0%<br />
- Advanced Features: üü° 30%</p>
<p><strong>Total Progress:</strong> ~85% complete<br />
<strong>Estimated Time to 100%:</strong> 4-6 weeks</p>
<hr />
<h2 id="part-3-integration-between-smt-and-fsm">Part 3: Integration Between SMT and FSM</h2>
<h3 id="31-current-status-not-integrated">3.1 Current Status: NOT INTEGRATED</h3>
<p><strong>Desired Integration:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># SMT-verified FSM properties (NOT IMPLEMENTED)</span>
<span class="n">fsm</span><span class="w"> </span><span class="n">VerifiedController</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">invariant</span><span class="p">:</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="c1"># Prove via SMT</span>

<span class="w">  </span><span class="n">State1</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="n">State2</span>
<span class="w">    </span><span class="n">when</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">balance</span><span class="w">  </span><span class="c1"># SMT-checked precondition</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="p">}</span>
<span class="n">end</span>
</code></pre></div>

<p><strong>Current Limitation:</strong> FSM and SMT are separate systems</p>
<p><strong>Workaround:</strong> Manually add guards and verify correctness</p>
<p><strong>Priority:</strong> Medium (depends on SMT Phase 5 and FSM verification)</p>
<p><strong>Estimated Time:</strong> 4-5 weeks (after both systems mature)</p>
<h3 id="32-planned-features">3.2 Planned Features</h3>
<ol>
<li>
<p><strong>FSM State Invariant Checking</strong><br />
   - Prove invariants hold across all transitions<br />
   - Generate counterexamples for violations</p>
</li>
<li>
<p><strong>FSM Deadlock Detection via SMT</strong><br />
   - Prove no state lacks outgoing transitions<br />
   - Prove all states are reachable</p>
</li>
<li>
<p><strong>FSM Refinement Verification</strong><br />
   - Prove one FSM refines another<br />
   - Check behavioral subtyping</p>
</li>
</ol>
<hr />
<h2 id="part-4-priority-recommendations">Part 4: Priority Recommendations</h2>
<h3 id="immediate-next-2-weeks">Immediate (Next 2 Weeks)</h3>
<ol>
<li>üî¥ <strong>FSM Registration Fix</strong> - Proper ETS ownership (2-3 days)</li>
<li>üî¥ <strong>CLI SMT Flags</strong> - Add --smt-timeout, --no-smt (1-2 days)</li>
<li>üî¥ <strong>FSM Multiple Definition Fix</strong> - Type inference improvement (1-2 weeks)</li>
</ol>
<h3 id="short-term-next-4-weeks">Short Term (Next 4 Weeks)</h3>
<ol start="4">
<li>üü° <strong>SMT User Guide</strong> - Documentation (3-4 days)</li>
<li>üü° <strong>FSM Best Practices</strong> - Documentation (2-3 days)</li>
<li>üü° <strong>SMT Error Messages</strong> - Improve diagnostics (2-3 days)</li>
</ol>
<h3 id="medium-term-next-8-weeks">Medium Term (Next 8 Weeks)</h3>
<ol start="7">
<li>üü¢ <strong>SMT Phase 2</strong> - Quantifiers and extended theories (2-3 weeks)</li>
<li>üü¢ <strong>FSM Verification Tools</strong> - Deadlock detection (3-4 weeks)</li>
<li>üü¢ <strong>SMT Phase 3</strong> - Refinement type subtyping (3-4 weeks)</li>
</ol>
<h3 id="long-term-next-16-weeks">Long Term (Next 16 Weeks)</h3>
<ol start="10">
<li>üîµ <strong>SMT Phase 4</strong> - LSP real-time verification (2-3 weeks)</li>
<li>üîµ <strong>SMT Phase 5</strong> - Pattern synthesis, FSM verification (4-6 weeks)</li>
<li>üîµ <strong>FSM Composition</strong> - Hierarchical FSMs (3-4 weeks)</li>
</ol>
<hr />
<h2 id="part-5-testing-status">Part 5: Testing Status</h2>
<h3 id="smt-testing">SMT Testing</h3>
<ul>
<li><strong>Unit Tests:</strong> 23/23 passing ‚úÖ</li>
<li><strong>Integration Tests:</strong> 6/6 passing ‚úÖ</li>
<li><strong>Example Programs:</strong> 2 working, 0 broken ‚úÖ</li>
<li><strong>Coverage:</strong> ~85% of Phase 1 code</li>
</ul>
<h3 id="fsm-testing">FSM Testing</h3>
<ul>
<li><strong>Unit Tests:</strong> All passing ‚úÖ</li>
<li><strong>Integration Tests:</strong> Passing ‚úÖ</li>
<li><strong>Example Programs:</strong> 2/3 working ‚ö†Ô∏è</li>
<li><strong>Coverage:</strong> ~80% of core FSM code</li>
</ul>
<h3 id="missing-test-coverage">Missing Test Coverage</h3>
<ul>
<li>‚ùå SMT quantifier tests (Phase 2 not implemented)</li>
<li>‚ùå SMT array theory tests (Phase 2)</li>
<li>‚ùå FSM verification tests (not implemented)</li>
<li>‚ùå FSM hot code reload tests</li>
<li>‚ùå SMT-FSM integration tests</li>
</ul>
<hr />
<h2 id="part-6-summary">Part 6: Summary</h2>
<h3 id="what-works-today-production-ready">What Works Today (Production-Ready)</h3>
<p>‚úÖ SMT basic constraint solving (arithmetic, logic, comparisons)<br />
‚úÖ FSM definition and compilation<br />
‚úÖ FSM runtime and event processing<br />
‚úÖ FSM standard library API<br />
‚úÖ Type-checked FFI integration<br />
‚úÖ Working examples for both systems  </p>
<h3 id="what-doesnt-work-known-issues">What Doesn't Work (Known Issues)</h3>
<p>üî¥ FSM registration requires manual call<br />
üî¥ Multiple FSMs per module fail type checking<br />
üî¥ No CLI flags for SMT configuration<br />
üü° Limited SMT error messages<br />
üü° No FSM verification tools  </p>
<h3 id="whats-postponed-clear-roadmap">What's Postponed (Clear Roadmap)</h3>
<p>üìã SMT Phases 2-5 (quantifiers, type system, LSP, advanced)<br />
üìã FSM verification via model checking<br />
üìã FSM composition and hierarchies<br />
üìã SMT-FSM deep integration  </p>
<h3 id="overall-assessment">Overall Assessment</h3>
<p>Both systems are <strong>production-ready for their core use cases</strong>:<br />
- Use SMT for basic constraint solving in type checking<br />
- Use FSM for state machine modeling and execution<br />
- Expect ~85% feature completeness for immediate needs<br />
- Clear roadmap for remaining 15% over next 16 weeks</p>
<p><strong>Recommendation:</strong> Deploy to production for core features while continuing development of advanced capabilities.</p>
<hr />
<p><strong>Document Version:</strong> 1.0<br />
<strong>Last Updated:</strong> 2025-11-19<br />
<strong>Next Review:</strong> After completing immediate priority items (2 weeks)</p>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Documentation</h4>
                <ul>
                    <li><a href="../docs.html">Getting Started</a></li>
                    <li><a href="language-spec.html">Language Specification</a></li>
                    <li><a href="type-system.html">Type System</a></li>
                    <li><a href="fsm-usage.html">FSM Guide</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>Reference</h4>
                <ul>
                    <li><a href="../api/index.html">API Reference</a></li>
                    <li><a href="std-summary.html">Standard Library</a></li>
                    <li><a href="feature-reference.html">Feature Reference</a></li>
                    <li><a href="cli-usage.html">CLI Usage</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>Resources</h4>
                <ul>
                    <li><a href="editor-setup.html">Editor Setup</a></li>
                    <li><a href="project-overview.html">Project Overview</a></li>
                    <li><a href="cure-ultimate-description.html">Ultimate Guide</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 Cure Programming Language. Verification-first programming for the BEAM.</p>
        </div>
    </footer>
</body>
</html>
