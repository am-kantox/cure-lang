<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Why SMT Solvers? A Deep Dive into Formal Verification - Cure Documentation</title>
    <meta name="description" content=" Table of Contents">
    <link rel="icon" type="image/png" href="../media/logo-128x128.png">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/cure-theme.css">
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <div class="nav-container">
            <div class="logo-section">
                <img src="../media/logo-128x128.png" alt="Cure Logo" class="logo">
                <div>
                    <h1 class="site-title">Cure</h1>
                    <p class="site-tagline">Verification-First Programming</p>
                </div>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="../docs.html">Documentation</a></li>
                    <li><a href="../api/index.html">API Reference</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="doc-page">
        <div class="doc-nav">
            <a href="../docs.html">← Back to Documentation</a>
        </div>
        
        <h1 id="why-smt-solvers-a-deep-dive-into-formal-verification">Why SMT Solvers? A Deep Dive into Formal Verification</h1>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#what-is-an-smt-solver">What is an SMT Solver?</a></li>
<li><a href="#z3-the-state-of-the-art-smt-solver">Z3: The State-of-the-Art SMT Solver</a></li>
<li><a href="#smt-solvers-and-code-quality">SMT Solvers and Code Quality</a></li>
<li><a href="#verification-of-data-aware-processes">Verification of Data-Aware Processes</a></li>
<li><a href="#fsm-verification-in-cure">FSM Verification in Cure</a></li>
<li><a href="#practical-examples">Practical Examples</a></li>
<li><a href="#integration-strategy">Integration Strategy</a></li>
<li><a href="#further-reading">Further Reading</a></li>
</ol>
<hr />
<h2 id="introduction">Introduction</h2>
<p>Modern software systems are growing increasingly complex, with state machines, concurrent processes, and intricate data dependencies. Traditional testing approaches—while valuable—cannot exhaustively verify all possible execution paths and states. This is where <strong>Satisfiability Modulo Theories (SMT)</strong> solvers become indispensable tools for formal verification.</p>
<p>The Cure language, with its built-in support for finite state machines (FSMs), dependent types, and refinement types, is uniquely positioned to benefit from SMT-based verification. This document explores how SMT solvers, particularly <strong>Z3</strong>, can dramatically improve code quality and provide mathematical guarantees about program correctness.</p>
<h3 id="understanding-smt-solvers-a-simple-introduction">Understanding SMT-Solvers: A Simple Introduction</h3>
<p>Imagine a puzzle where certain rules must always be obeyed, and the goal is to find out if there’s any way to make all the pieces fit without breaking any rules. SMT-solvers, short for Satisfiability Modulo Theories solvers, are special computer programs designed to solve these rule-based puzzles automatically<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup><sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>. </p>
<p>In practical terms, SMT-solvers answer questions like: "Given all the rules (mathematical, logical, or data-related), is there any combination of values that keeps everything true and consistent?" For example, they can check if a set of formulas describing a piece of software will ever run into errors, if a digital circuit will always work correctly, or even if a robot can safely move given complicated obstacles and instructions<sup id="fnref2:1"><a class="footnote-ref" href="#fn:1">1</a></sup>. </p>
<p>What makes SMT-solvers powerful is that rather than just working with basic true/false logic, they also understand deeper mathematical topics—like arithmetic, relationships between data, and more. They look at every part of the puzzle, combining logic and math, to figure out whether a solution exists or not. If the puzzle can’t be solved, they can even help you pinpoint exactly why it fails<sup id="fnref3:1"><a class="footnote-ref" href="#fn:1">1</a></sup><sup id="fnref2:2"><a class="footnote-ref" href="#fn:2">2</a></sup>.</p>
<hr />
<h3 id="satisfiability-modulo-theories-smt-solvers-in-critical-development">Satisfiability Modulo Theories (SMT) Solvers in Critical Development</h3>
<p>SMT-solvers are computational systems that determine whether statements involving variables and constraints are satisfiable under a range of mathematical theories (such as arithmetic, arrays, bit-vectors, and more)<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup><sup id="fnref:4"><a class="footnote-ref" href="#fn:4">4</a></sup>.</p>
<h4 id="what-are-smt-solvers">What Are SMT-Solvers?</h4>
<p>SMT-solvers generalize SAT-solvers (Boolean satisfiability) to additional, expressive theories. This enables the automated analysis of formulas that capture constraints and properties found in realistic software, hardware, and business systems.<sup id="fnref2:3"><a class="footnote-ref" href="#fn:3">3</a></sup><sup id="fnref2:4"><a class="footnote-ref" href="#fn:4">4</a></sup></p>
<ul>
<li><strong>Defining Role:</strong> They solve logic formulas containing variables and constraints from chosen mathematical theories, checking if any satisfying assignment exists.<sup id="fnref9:3"><a class="footnote-ref" href="#fn:3">3</a></sup></li>
<li><strong>Use Domains:</strong> These include data-aware workflows, software correctness, circuit design, security analysis, and AI planning.<sup id="fnref10:3"><a class="footnote-ref" href="#fn:3">3</a></sup><sup id="fnref9:4"><a class="footnote-ref" href="#fn:4">4</a></sup></li>
</ul>
<p>See below for more detailed description.</p>
<h4 id="why-smt-solvers-matter-in-critical-development">Why SMT-Solvers Matter in Critical Development</h4>
<p>SMT-solvers are fundamental in modern software and systems engineering, particularly for safety-critical and high-assurance domains:</p>
<ul>
<li><strong>Rigorous Verification:</strong> They automate model checking and formal verification, proving that systems behave correctly in all cases—essential in aviation, medicine, and finance.<sup id="fnref6:3"><a class="footnote-ref" href="#fn:3">3</a></sup><sup id="fnref6:4"><a class="footnote-ref" href="#fn:4">4</a></sup></li>
<li><strong>Bug &amp; Vulnerability Discovery:</strong> Developers encode requirements and invariants as logical formulas; SMT-solvers uncover bugs, unreachable states or vulnerabilities automatically.<sup id="fnref7:3"><a class="footnote-ref" href="#fn:3">3</a></sup><sup id="fnref7:4"><a class="footnote-ref" href="#fn:4">4</a></sup></li>
<li><strong>Design Optimization &amp; Synthesis:</strong> They search huge design spaces for feasible solutions under constraints.</li>
<li><strong>Productivity &amp; Reliability:</strong> Engineers delegate difficult formal reasoning, focusing on design and innovation.<sup id="fnref8:3"><a class="footnote-ref" href="#fn:3">3</a></sup><sup id="fnref8:4"><a class="footnote-ref" href="#fn:4">4</a></sup></li>
</ul>
<h4 id="key-educational-source-alessandro-gianolas-research">Key Educational Source: Alessandro Gianola’s Research</h4>
<p>A foundational resource for using SMT-solvers in system verification is Alessandro Gianola’s work, especially his dissertation “SMT-based Safety Verification of Data-Aware Processes: Foundations and Applications.”<sup id="fnref3:3"><a class="footnote-ref" href="#fn:3">3</a></sup></p>
<ul>
<li><strong>Summary:</strong> Gianola’s research bridges the gap between model checking for infinite-state systems and verification of data-aware business processes. It shows how SMT-solvers (and their underlying logic frameworks) enable verification of workflows and processes that depend on both control flow and rich data.<sup id="fnref4:3"><a class="footnote-ref" href="#fn:3">3</a></sup><sup id="fnref4:4"><a class="footnote-ref" href="#fn:4">4</a></sup></li>
<li><strong>Practical Impact:</strong> Gianola’s methods use SMT to encode and verify properties (like safety) for processes with both data and state logic, allowing exhaustive and scalable analysis even when manual checking is impossible.<sup id="fnref5:3"><a class="footnote-ref" href="#fn:3">3</a></sup><sup id="fnref5:4"><a class="footnote-ref" href="#fn:4">4</a></sup></li>
<li><strong>Additional Reading:</strong> See Gianola’s thesis and related publications for algorithms, theoretical models, and benchmarking of SMT-verification tools.</li>
</ul>
<h4 id="z3-leading-smt-solver">Z3: Leading SMT-Solver</h4>
<p>Currently, Z3 from Microsoft Research is seen as the most advanced and robust SMT-solver:</p>
<ul>
<li><strong>Theory Coverage:</strong> Supports integers, reals, arrays, bit-vectors, and uninterpreted functions.</li>
<li><strong>Performance &amp; Integration:</strong> Fast solving engines, modern APIs for Python, C++, Java, and more.</li>
<li><strong>Community Usage:</strong> Z3 is open-source and prominent in both academic research and industrial applications.<sup id="fnref3:4"><a class="footnote-ref" href="#fn:4">4</a></sup></li>
</ul>
<hr />
<h2 id="what-is-an-smt-solver-part-ii">What is an SMT Solver (Part II)?</h2>
<h3 id="the-foundation-sat-solvers">The Foundation: SAT Solvers</h3>
<p>A <strong>SAT (Boolean Satisfiability) solver</strong> determines whether a Boolean formula can be satisfied—that is, whether there exists an assignment of variables that makes the formula true. For example:</p>
<div class="codehilite"><pre><span></span><code>(A ∨ B) ∧ (¬A ∨ C) ∧ (¬B ∨ ¬C)
</code></pre></div>

<p>A SAT solver would find that <code>A = true, B = false, C = true</code> satisfies this formula.</p>
<h3 id="beyond-boolean-smt-solvers">Beyond Boolean: SMT Solvers</h3>
<p><strong>SMT (Satisfiability Modulo Theories)</strong> solvers extend SAT solvers to handle richer logical theories beyond pure Boolean logic. These theories include:</p>
<ul>
<li><strong>Linear Arithmetic</strong>: <code>x + 2y ≤ 5</code>, <code>3a - b = 7</code></li>
<li><strong>Arrays</strong>: <code>select(store(a, i, v), i) = v</code></li>
<li><strong>Bit-vectors</strong>: Operations on fixed-width integers</li>
<li><strong>Uninterpreted Functions</strong>: Abstract function symbols</li>
<li><strong>Algebraic Datatypes</strong>: Recursive structures like lists and trees</li>
<li><strong>Strings</strong>: String operations and constraints</li>
<li><strong>Quantifiers</strong>: ∀x, ∃y predicates</li>
</ul>
<h3 id="how-smt-solvers-work">How SMT Solvers Work</h3>
<p>SMT solvers typically employ a <strong>lazy SMT</strong> approach:</p>
<ol>
<li><strong>Abstract</strong> the problem into a Boolean SAT formula</li>
<li><strong>Solve</strong> the Boolean formula using an efficient SAT solver</li>
<li><strong>Check</strong> if the solution is consistent with the background theories</li>
<li>If inconsistent, add <strong>theory lemmas</strong> and repeat</li>
</ol>
<p>This architecture combines the efficiency of modern SAT solvers with the expressiveness of domain-specific theories.</p>
<hr />
<h2 id="z3-the-state-of-the-art-smt-solver">Z3: The State-of-the-Art SMT Solver</h2>
<h3 id="overview">Overview</h3>
<p><strong>Z3</strong> is a high-performance SMT solver developed by Microsoft Research. It has become the de facto standard for program verification, symbolic execution, and formal methods research.</p>
<h3 id="key-features">Key Features</h3>
<ol>
<li><strong>Multiple Theories</strong>: Supports arithmetic, arrays, bit-vectors, algebraic datatypes, and more</li>
<li><strong>Quantifier Support</strong>: Sophisticated instantiation heuristics for universal/existential quantifiers</li>
<li><strong>Optimization</strong>: Can find optimal solutions (maximize/minimize objectives)</li>
<li><strong>Proof Generation</strong>: Produces proofs that solutions are correct</li>
<li><strong>Multiple Interfaces</strong>: APIs for C, C++, Python, OCaml, Java, .NET, and more</li>
<li><strong>Active Development</strong>: Continuously improved with cutting-edge research</li>
</ol>
<h3 id="z3-architecture">Z3 Architecture</h3>
<div class="codehilite"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w">           </span><span class="nx">User</span><span class="w"> </span><span class="nx">Interface</span><span class="w"> </span><span class="p">(</span><span class="nx">APIs</span><span class="p">)</span><span class="w">             </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">         </span><span class="nx">SMT</span><span class="o">-</span><span class="nx">LIB</span><span class="w"> </span><span class="m m-Double">2.0</span><span class="w"> </span><span class="nx">Parser</span><span class="w">                  </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">     </span><span class="nx">Preprocessing</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">Simplification</span><span class="w">          </span><span class="err">│</span>
<span class="err">├─────────────────────────────────────────────┤</span>
<span class="err">│</span><span class="w">         </span><span class="nx">Core</span><span class="w"> </span><span class="nx">SAT</span><span class="w"> </span><span class="nx">Solver</span><span class="w"> </span><span class="p">(</span><span class="nx">DPLL</span><span class="p">)</span><span class="w">              </span><span class="err">│</span>
<span class="err">├───────────┬─────────────┬───────────────────┤</span>
<span class="err">│</span><span class="w"> </span><span class="nx">Arithmetic</span><span class="err">│</span><span class="w">   </span><span class="nx">Arrays</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="nx">Datatypes</span><span class="w">       </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nx">Theory</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="nx">Theory</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="nx">Theory</span><span class="w">          </span><span class="err">│</span>
<span class="err">│</span><span class="w">  </span><span class="nx">Solver</span><span class="w">   </span><span class="err">│</span><span class="w">   </span><span class="nx">Solver</span><span class="w">    </span><span class="err">│</span><span class="w">   </span><span class="nx">Solver</span><span class="w">          </span><span class="err">│</span>
<span class="err">└───────────┴─────────────┴───────────────────┘</span>
</code></pre></div>

<h3 id="why-z3">Why Z3?</h3>
<ul>
<li><strong>Proven Track Record</strong>: Used in Windows driver verification, .NET static analysis, and numerous academic projects</li>
<li><strong>Performance</strong>: Consistently wins SMT-COMP competitions</li>
<li><strong>Extensibility</strong>: Easy to integrate into custom verification tools</li>
<li><strong>Documentation</strong>: Comprehensive guides and active community</li>
</ul>
<hr />
<h2 id="smt-solvers-and-code-quality">SMT Solvers and Code Quality</h2>
<h3 id="the-testing-vs-verification-spectrum">The Testing vs. Verification Spectrum</h3>
<div class="codehilite"><pre><span></span><code>Testing                                    Formal Verification
  │                                              │
  ├─── Unit Tests                                │
  ├─── Integration Tests                         │
  ├─── Property-Based Tests                      │
  ├─── Symbolic Execution ────────────────────┐  │
  │                                           │  │
  │                                           ▼  ▼
  │                                         SMT Solver
  │                                               │
  └───────────────────────────────────────────────┘
         Partial Coverage              Complete Guarantees
</code></pre></div>

<h3 id="how-smt-improves-code-quality">How SMT Improves Code Quality</h3>
<h4 id="1-exhaustive-path-coverage">1. <strong>Exhaustive Path Coverage</strong></h4>
<p>Traditional testing explores a finite set of execution paths. SMT-based verification considers <em>all possible paths</em> symbolically.</p>
<p><strong>Example</strong>: Verifying array bounds (below is pseudocode)</p>
<div class="codehilite"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="k">Without</span><span class="w"> </span><span class="nl">SMT</span><span class="p">:</span><span class="w"> </span><span class="n">Hope</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">tested</span><span class="w"> </span><span class="n">enough</span><span class="w"> </span><span class="n">edge</span><span class="w"> </span><span class="n">cases</span>
<span class="n">def</span><span class="w"> </span><span class="n">access_array</span><span class="p">(</span><span class="nl">arr</span><span class="p">:</span><span class="w"> </span><span class="n">Vector</span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="nl">idx</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">arr</span><span class="o">[</span><span class="n">idx</span><span class="o">]</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Runtime</span><span class="w"> </span><span class="k">check</span><span class="err">:</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="vm">?</span>

<span class="err">#</span><span class="w"> </span><span class="k">With</span><span class="w"> </span><span class="nl">SMT</span><span class="p">:</span><span class="w"> </span><span class="n">Compile</span><span class="o">-</span><span class="nc">time</span><span class="w"> </span><span class="n">guarantee</span>
<span class="n">def</span><span class="w"> </span><span class="n">access_array</span><span class="p">(</span><span class="nl">arr</span><span class="p">:</span><span class="w"> </span><span class="k">Array</span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="nl">idx</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="nl">i</span><span class="p">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="err">}</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nc">Int</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">arr</span><span class="o">[</span><span class="n">idx</span><span class="o">]</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Provably</span><span class="w"> </span><span class="n">safe</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="k">check</span><span class="w"> </span><span class="n">needed</span><span class="err">!</span>
</code></pre></div>

<h4 id="2-finding-subtle-bugs">2. <strong>Finding Subtle Bugs</strong></h4>
<p>SMT solvers excel at finding corner cases that humans miss.</p>
<p>[TODO] Fins an example for that</p>
<h4 id="3-proving-absence-of-errors">3. <strong>Proving Absence of Errors</strong></h4>
<p>Instead of finding bugs, SMT can prove <em>no bugs exist</em> under specified conditions.</p>
<p><strong>Example</strong>: Division by zero</p>
<div class="codehilite"><pre><span></span><code><span class="cp"># Without SMT: Runtime check required</span>
<span class="n">def</span><span class="w"> </span><span class="n">divide</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">Int</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Int</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="n">match</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">do</span>
<span class="w">    </span><span class="kr">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nf">error</span><span class="p">(</span><span class="s">&quot;Division by zero&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kr">false</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ok</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">  </span><span class="kd">end</span>

<span class="cp"># With SMT: Compile-time guarantee via guard</span>
<span class="n">def</span><span class="w"> </span><span class="n">safe_divide</span><span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">Int</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Int</span><span class="w"> </span><span class="kr">when</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">y</span>
<span class="cp"># SMT solver verifies y != 0 before allowing division</span>
</code></pre></div>

<h4 id="4-guard-completeness-verification">4. <strong>Guard Completeness Verification</strong> ✅</h4>
<p>Cure uses SMT solvers to verify that function guards cover all possible input values:</p>
<p><strong>Example</strong>: Complete guard coverage</p>
<div class="codehilite"><pre><span></span><code>#<span class="w"> </span><span class="nv">Guards</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">sign</span><span class="w"> </span><span class="nv">function</span>
<span class="nv">def</span><span class="w"> </span><span class="nv">sign</span><span class="ss">(</span><span class="nv">x</span>:<span class="w"> </span><span class="nv">Int</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="nv">def</span><span class="w"> </span><span class="nv">sign</span><span class="ss">(</span><span class="nv">x</span>:<span class="w"> </span><span class="nv">Int</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="nv">def</span><span class="w"> </span><span class="nv">sign</span><span class="ss">(</span><span class="nv">x</span>:<span class="w"> </span><span class="nv">Int</span><span class="ss">)</span>:<span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>

#<span class="w"> </span><span class="nv">SMT</span><span class="w"> </span><span class="nv">verification</span>:<span class="w"> </span><span class="ss">(</span><span class="nv">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span>∨<span class="w"> </span><span class="ss">(</span><span class="nv">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span>∨<span class="w"> </span><span class="ss">(</span><span class="nv">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="ss">)</span><span class="w"> </span>≡<span class="w"> </span><span class="nv">true</span><span class="w"> </span>✓
#<span class="w"> </span><span class="nv">Compiler</span><span class="w"> </span><span class="nv">proves</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">Int</span><span class="w"> </span><span class="nv">values</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">covered</span>
</code></pre></div>

<p><strong>Example</strong>: Detecting unreachable clauses</p>
<div class="codehilite"><pre><span></span><code class="language-cure"># Redundant guard warning
def classify(x: Int): String when x &gt;= 0 = &quot;non-negative&quot;
def classify(x: Int): String when x &gt; 10 = &quot;large&quot;  # Unreachable!
def classify(x: Int): String = &quot;negative&quot;

# SMT detection: (x &gt;= 0) subsumes (x &gt; 10)
# Compiler warning: Second clause will never execute
</code></pre></div>

<p><strong>Implementation</strong>: See <code>cure_guard_smt.erl</code> for:<br />
- Guard completeness checking<br />
- Subsumption detection<br />
- Counterexample generation<br />
- Inconsistent guard detection</p>
<div class="codehilite"><pre><span></span><code><span class="k">type</span><span class="w"> </span><span class="nx">NonZero</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">x</span><span class="p">:</span><span class="w"> </span><span class="nx">Int</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">safe_divide</span><span class="p">(</span><span class="nx">a</span><span class="p">:</span><span class="w"> </span><span class="nx">Int</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">:</span><span class="w"> </span><span class="nx">NonZero</span><span class="p">):</span><span class="w"> </span><span class="nx">Int</span><span class="w"> </span><span class="p">=</span>
<span class="w">  </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">Provably</span><span class="w"> </span><span class="nx">safe</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Z3</span><span class="w"> </span><span class="nx">verifies</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nx">always</span><span class="w"> </span><span class="nx">holds</span>
</code></pre></div>

<h4 id="4-validating-optimizations">4. <strong>Validating Optimizations</strong></h4>
<p>Compilers can use SMT to verify that optimizations preserve semantics.</p>
<div class="codehilite"><pre><span></span><code><span class="gh">#</span> Original
def compute_original(x: Int): Int =
  (x + 1) <span class="gs">* (x + 1) - x *</span> x - 2 * x

<span class="gh">#</span> Optimized
def compute_optimized(x: Int): Int =
  1

<span class="gh">#</span> SMT verification: ∀x. compute_original(x) = compute_optimized(x) ✓
</code></pre></div>

<h4 id="5-specification-compliance">5. <strong>Specification Compliance</strong></h4>
<p>SMT verifies implementations match formal specifications.</p>
<div class="codehilite"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nl">Specification</span><span class="p">:</span><span class="w"> </span><span class="n">sorting</span><span class="w"> </span><span class="n">produces</span><span class="w"> </span><span class="n">ordered</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">elements</span>
<span class="n">spec</span><span class="w"> </span><span class="n">def</span><span class="w"> </span><span class="n">is_sorted</span><span class="p">(</span><span class="nl">v</span><span class="p">:</span><span class="w"> </span><span class="n">Vector</span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="err">:</span><span class="w"> </span><span class="n">Bool</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="err">∀</span><span class="n">i</span><span class="w"> </span><span class="n">j</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">v</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">v</span><span class="o">[</span><span class="n">j</span><span class="o">]</span>

<span class="n">spec</span><span class="w"> </span><span class="n">def</span><span class="w"> </span><span class="n">same_multiset</span><span class="p">(</span><span class="nl">v1</span><span class="p">:</span><span class="w"> </span><span class="n">Vector</span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="nl">v2</span><span class="p">:</span><span class="w"> </span><span class="n">Vector</span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="err">:</span><span class="w"> </span><span class="n">Bool</span><span class="w"> </span><span class="o">=</span>
<span class="w">  </span><span class="err">∀</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">count</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>

<span class="err">#</span><span class="w"> </span><span class="n">Implementation</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">satisfy</span><span class="w"> </span><span class="k">both</span><span class="w"> </span><span class="n">properties</span>
<span class="n">def</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="nl">arr</span><span class="p">:</span><span class="w"> </span><span class="n">Vector</span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="err">:</span><span class="w"> </span><span class="n">Vector</span><span class="p">(</span><span class="nc">Int</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="w">  </span><span class="n">ensures</span><span class="w"> </span><span class="n">is_sorted</span><span class="p">(</span><span class="k">result</span><span class="p">)</span><span class="w"> </span><span class="err">∧</span><span class="w"> </span><span class="n">same_multiset</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="w"> </span><span class="k">result</span><span class="p">)</span>
<span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
</code></pre></div>

<hr />
<h2 id="verification-of-data-aware-processes">Verification of Data-Aware Processes</h2>
<h3 id="background-the-gianola-framework">Background: The Gianola Framework</h3>
<p><strong>"Verification of Data-Aware Processes via Satisfiability Modulo Theories"</strong> by Alessandro Gianola presents a comprehensive framework for verifying systems that combine:</p>
<ul>
<li><strong>Control flow</strong>: State machines, workflows, business processes</li>
<li><strong>Data manipulation</strong>: Variables, databases, external state</li>
<li><strong>Infinite state spaces</strong>: Unbounded integers, arrays, data structures</li>
</ul>
<p>This is precisely the problem domain that Cure FSMs inhabit.</p>
<h3 id="key-insights-from-gianolas-work">Key Insights from Gianola's Work</h3>
<h4 id="1-data-aware-processes">1. <strong>Data-Aware Processes</strong></h4>
<p>A <strong>data-aware process</strong> consists of:<br />
- A finite set of <strong>control states</strong> (FSM states)<br />
- A <strong>data schema</strong> (variables, types, constraints)<br />
- <strong>Transition guards</strong> (conditions on data)<br />
- <strong>Actions</strong> (data transformations)</p>
<p>This maps directly to Cure's FSM model:</p>
<div class="codehilite"><pre><span></span><code><span class="n">record</span><span class="w"> </span><span class="n">TrafficPayload</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">cycles_completed</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span><span class="w">        </span><span class="c1"># Data schema</span>
<span class="w">  </span><span class="n">timer_events</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>
<span class="w">  </span><span class="n">emergency_stops</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>
<span class="n">end</span>

<span class="n">fsm</span><span class="w"> </span><span class="n">TrafficPayload</span><span class="p">{</span><span class="o">...</span><span class="p">}</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">Red</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">Green</span><span class="w">        </span><span class="c1"># Control states and transitions</span>
<span class="w">  </span><span class="n">Green</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">Yellow</span>
<span class="w">  </span><span class="n">Yellow</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">Red</span>
<span class="n">end</span>
</code></pre></div>

<h4 id="2-verification-problems">2. <strong>Verification Problems</strong></h4>
<p>Gianola identifies critical verification problems:</p>
<ul>
<li><strong>Reachability</strong>: Can we reach a specific state?</li>
<li><strong>Safety</strong>: Do we always avoid bad states?</li>
<li><strong>Liveness</strong>: Do we eventually reach good states?</li>
<li><strong>Deadlock Freedom</strong>: Can the system always make progress?</li>
</ul>
<h4 id="3-smt-based-decision-procedures">3. <strong>SMT-Based Decision Procedures</strong></h4>
<p>The book presents algorithms that reduce these problems to SMT queries:</p>
<div class="codehilite"><pre><span></span><code><span class="n">Reachability</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="n">sf</span><span class="p">)</span><span class="err">:</span>
<span class="w">  </span><span class="err">∃</span><span class="w"> </span><span class="k">path</span><span class="p">.</span><span class="w"> </span><span class="k">path</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s0</span><span class="w"> </span><span class="err">∧</span><span class="w"> </span><span class="k">path</span><span class="o">[</span><span class="n">n</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sf</span><span class="w"> </span><span class="err">∧</span>
<span class="w">          </span><span class="err">∀</span><span class="n">i</span><span class="p">.</span><span class="w"> </span><span class="n">valid_transition</span><span class="p">(</span><span class="k">path</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="k">path</span><span class="o">[</span><span class="n">i+1</span><span class="o">]</span><span class="p">)</span>

<span class="n">Safety</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="n">bad</span><span class="p">)</span><span class="err">:</span>
<span class="w">  </span><span class="err">¬∃</span><span class="w"> </span><span class="k">path</span><span class="p">.</span><span class="w"> </span><span class="k">path</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s0</span><span class="w"> </span><span class="err">∧</span><span class="w"> </span><span class="err">∃</span><span class="n">i</span><span class="p">.</span><span class="w"> </span><span class="k">path</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="err">∈</span><span class="w"> </span><span class="n">bad</span>

<span class="n">Liveness</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span><span class="w"> </span><span class="n">good</span><span class="p">)</span><span class="err">:</span>
<span class="w">  </span><span class="err">∀</span><span class="w"> </span><span class="k">path</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">s0</span><span class="p">.</span><span class="w"> </span><span class="err">∃</span><span class="n">i</span><span class="p">.</span><span class="w"> </span><span class="k">path</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="err">∈</span><span class="w"> </span><span class="n">good</span>
</code></pre></div>

<p>Z3 can solve these queries even with complex data constraints.</p>
<h4 id="4-bounded-model-checking">4. <strong>Bounded Model Checking</strong></h4>
<p>For infinite-state systems, <strong>bounded model checking</strong> explores up to depth <em>k</em>:</p>
<div class="codehilite"><pre><span></span><code>Reachable_k(s0, sf):
  Check all paths of length ≤ k from s0 to sf
</code></pre></div>

<p>If no bug found up to depth <em>k</em>, increase <em>k</em>. SMT solvers efficiently handle increasing bounds.</p>
<h4 id="5-invariant-synthesis">5. <strong>Invariant Synthesis</strong></h4>
<p>Gianola describes techniques to automatically discover <strong>invariants</strong>—properties that hold in all reachable states:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Synthesized invariant for traffic light</span>
<span class="n">invariant</span><span class="w"> </span><span class="n">TrafficLight</span><span class="p">:</span>
<span class="w">  </span><span class="err">∀</span><span class="w"> </span><span class="n">state</span><span class="o">.</span><span class="w"> </span><span class="n">cycles_completed</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="err">∧</span>
<span class="w">           </span><span class="n">timer_events</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">cycles_completed</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">∧</span>
<span class="w">           </span><span class="n">emergency_stops</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span>
</code></pre></div>

<p>Z3's quantifier reasoning helps discover such invariants automatically.</p>
<hr />
<h2 id="fsm-verification-in-cure">FSM Verification in Cure</h2>
<h3 id="cures-verification-opportunities">Cure's Verification Opportunities</h3>
<p>Cure's design makes it ideal for SMT-based verification:</p>
<ol>
<li><strong>Explicit FSM Definitions</strong>: Clear state space and transitions</li>
<li><strong>Dependent Types</strong>: Rich type system with refinements</li>
<li><strong>Guards and Actions</strong>: Explicitly stated data constraints</li>
<li><strong>Immutability</strong>: Functional core simplifies reasoning</li>
</ol>
<h3 id="verification-properties-for-cure-fsms">Verification Properties for Cure FSMs</h3>
<h4 id="property-1-state-reachability">Property 1: State Reachability</h4>
<p><strong>Problem</strong>: Can state <code>S</code> be reached from the initial state?</p>
<p><strong>Cure Example</strong> (from <code>07_fsm_verification.cure</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="n">fsm</span><span class="w"> </span><span class="n">LightState</span><span class="p">{</span><span class="n">cycle_count</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">Red</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">Green</span><span class="w"> </span><span class="p">{</span><span class="n">cycle_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cycle_count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
<span class="w">  </span><span class="n">Green</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">Yellow</span>
<span class="w">  </span><span class="n">Yellow</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">Red</span>
<span class="w">  </span><span class="n">Red</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">emergency</span><span class="o">|</span><span class="w"> </span><span class="n">Red</span>
<span class="w">  </span><span class="n">Green</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">emergency</span><span class="o">|</span><span class="w"> </span><span class="n">Red</span>
<span class="w">  </span><span class="n">Yellow</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">emergency</span><span class="o">|</span><span class="w"> </span><span class="n">Red</span>
<span class="kd">end</span>

<span class="cp"># Verification query:</span>
<span class="cp"># Is Yellow reachable from Red?</span>
<span class="cp"># Answer: Yes, via path Red → Green → Yellow</span>
</code></pre></div>

<p><strong>Z3 Encoding</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nx">declare</span><span class="o">-</span><span class="nx">datatypes</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">((</span><span class="nx">State</span><span class="w"> </span><span class="nx">Red</span><span class="w"> </span><span class="nx">Green</span><span class="w"> </span><span class="nx">Yellow</span><span class="p">)))</span>
<span class="p">(</span><span class="nx">declare</span><span class="o">-</span><span class="nx">fun</span><span class="w"> </span><span class="nx">step</span><span class="w"> </span><span class="p">(</span><span class="nx">State</span><span class="p">)</span><span class="w"> </span><span class="nx">State</span><span class="p">)</span>

<span class="p">(</span><span class="nx">assert</span><span class="w"> </span><span class="p">(</span><span class="k">or</span>
<span class="w">  </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="w"> </span><span class="nx">Red</span><span class="p">)</span><span class="w"> </span><span class="nx">Green</span><span class="p">)</span>
<span class="w">  </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="w"> </span><span class="nx">Red</span><span class="p">)</span><span class="w"> </span><span class="nx">Red</span><span class="p">)))</span>
<span class="p">(</span><span class="nx">assert</span><span class="w"> </span><span class="p">(</span><span class="k">or</span>
<span class="w">  </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="w"> </span><span class="nx">Green</span><span class="p">)</span><span class="w"> </span><span class="nx">Yellow</span><span class="p">)</span>
<span class="w">  </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="w"> </span><span class="nx">Green</span><span class="p">)</span><span class="w"> </span><span class="nx">Red</span><span class="p">)))</span>
<span class="p">(</span><span class="nx">assert</span><span class="w"> </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="w"> </span><span class="nx">Yellow</span><span class="p">)</span><span class="w"> </span><span class="nx">Red</span><span class="p">))</span>

<span class="p">(</span><span class="nx">assert</span><span class="w"> </span><span class="p">(=</span><span class="w"> </span><span class="nx">Yellow</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="w"> </span><span class="p">(</span><span class="nx">step</span><span class="w"> </span><span class="nx">Red</span><span class="p">))))</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="nx">Can</span><span class="w"> </span><span class="nx">reach</span><span class="w"> </span><span class="nx">Yellow</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nx">steps</span><span class="p">?</span>
<span class="p">(</span><span class="nx">check</span><span class="o">-</span><span class="nx">sat</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="nx">sat</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nx">yes</span><span class="p">,</span><span class="w"> </span><span class="nx">reachable</span>
</code></pre></div>

<h4 id="property-2-deadlock-detection">Property 2: Deadlock Detection</h4>
<p><strong>Problem</strong>: Is there a state with no outgoing transitions?</p>
<p><strong>Cure Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">fsm</span><span class="w"> </span><span class="n">CounterState</span><span class="p">{</span><span class="nf">count</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">max_count</span><span class="o">:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">Counting</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">increment</span><span class="o">|</span><span class="w"> </span><span class="n">Counting</span><span class="w"> </span><span class="p">{</span><span class="nf">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
<span class="w">  </span><span class="n">Counting</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">check</span><span class="o">|</span><span class="w"> </span><span class="n">Done</span><span class="w"> </span><span class="p">{</span><span class="kr">when</span><span class="w"> </span><span class="nf">count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">max_count</span><span class="p">}</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Done</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">outgoing</span><span class="w"> </span><span class="n">transitions</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">DEADLOCK</span>
<span class="kd">end</span>
</code></pre></div>

<p><strong>Z3 Encoding</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nx">declare</span><span class="o">-</span><span class="nx">datatypes</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">((</span><span class="nx">State</span><span class="w"> </span><span class="nx">Counting</span><span class="w"> </span><span class="nx">Done</span><span class="p">)))</span>
<span class="p">(</span><span class="nx">declare</span><span class="o">-</span><span class="nx">fun</span><span class="w"> </span><span class="nx">next</span><span class="w"> </span><span class="p">(</span><span class="nx">State</span><span class="p">)</span><span class="w"> </span><span class="nx">State</span><span class="p">)</span>

<span class="p">;</span><span class="w"> </span><span class="nx">Define</span><span class="w"> </span><span class="nx">transitions</span>
<span class="p">(</span><span class="nx">assert</span><span class="w"> </span><span class="p">(</span><span class="k">or</span>
<span class="w">  </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">Counting</span><span class="p">)</span><span class="w"> </span><span class="nx">Counting</span><span class="p">)</span>
<span class="w">  </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">Counting</span><span class="p">)</span><span class="w"> </span><span class="nx">Done</span><span class="p">)))</span>

<span class="p">;</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">Done</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">deadlock</span>
<span class="p">(</span><span class="nx">assert</span><span class="w"> </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">Done</span><span class="p">)</span><span class="w"> </span><span class="nx">Done</span><span class="p">))</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="nx">No</span><span class="w"> </span><span class="nx">real</span><span class="w"> </span><span class="nx">transition</span><span class="p">,</span><span class="w"> </span><span class="kp">self</span><span class="o">-</span><span class="nx">loop</span>
<span class="p">(</span><span class="nx">assert</span><span class="w"> </span><span class="p">(</span><span class="nx">distinct</span><span class="w"> </span><span class="nx">Done</span><span class="w"> </span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">Done</span><span class="p">)))</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="nx">Try</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">find</span><span class="w"> </span><span class="nx">different</span><span class="w"> </span><span class="nx">next</span><span class="w"> </span><span class="nx">state</span>
<span class="p">(</span><span class="nx">check</span><span class="o">-</span><span class="nx">sat</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="nx">unsat</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nx">deadlock</span><span class="w"> </span><span class="nx">confirmed</span>
</code></pre></div>

<h4 id="property-3-safety-properties">Property 3: Safety Properties</h4>
<p><strong>Problem</strong>: Can we reach a "bad" state?</p>
<p><strong>Cure Example</strong> (from <code>07_fsm_verification.cure</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="kd">record </span><span class="n">DoorState</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">is_locked</span><span class="o">:</span><span class="w"> </span><span class="n">Int</span><span class="w">      </span><span class="err">#</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">locked</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unlocked</span>
<span class="w">  </span><span class="n">alarm_active</span><span class="o">:</span><span class="w"> </span><span class="n">Int</span><span class="w">   </span><span class="err">#</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">active</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inactive</span>
<span class="kd">end</span>

<span class="n">fsm</span><span class="w"> </span><span class="n">DoorState</span><span class="p">{</span><span class="n">is_locked</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">alarm_active</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">Locked</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">unlock</span><span class="o">|</span><span class="w"> </span><span class="n">Unlocked</span><span class="w"> </span><span class="p">{</span><span class="n">is_locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kr">when</span><span class="w"> </span><span class="n">alarm_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span>
<span class="w">  </span><span class="n">Unlocked</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">lock</span><span class="o">|</span><span class="w"> </span><span class="n">Locked</span><span class="w"> </span><span class="p">{</span><span class="n">is_locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
<span class="w">  </span><span class="n">Locked</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">activate_alarm</span><span class="o">|</span><span class="w"> </span><span class="n">LockedWithAlarm</span><span class="w"> </span><span class="p">{</span><span class="n">alarm_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
<span class="w">  </span><span class="n">LockedWithAlarm</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">deactivate_alarm</span><span class="o">|</span><span class="w"> </span><span class="n">Locked</span><span class="w"> </span><span class="p">{</span><span class="n">alarm_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">NO</span><span class="w"> </span><span class="n">transition</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">LockedWithAlarm</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Unlocked</span>
<span class="kd">end</span>

<span class="cp"># Safety property: ¬(is_locked = 0 ∧ alarm_active = 1)</span>
<span class="cp"># &quot;Never unlocked while alarm is active&quot;</span>
</code></pre></div>

<p><strong>Z3 Verification</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="n">datatypes</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">((</span><span class="n">State</span><span class="w"> </span><span class="n">Locked</span><span class="w"> </span><span class="n">Unlocked</span><span class="w"> </span><span class="n">LockedWithAlarm</span><span class="p">)))</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="n">fun</span><span class="w"> </span><span class="n">is_locked</span><span class="w"> </span><span class="p">(</span><span class="n">State</span><span class="p">)</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="n">fun</span><span class="w"> </span><span class="n">alarm_active</span><span class="w"> </span><span class="p">(</span><span class="n">State</span><span class="p">)</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>

<span class="p">;</span><span class="w"> </span><span class="n">Define</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">invariants</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">is_locked</span><span class="w"> </span><span class="n">Locked</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">alarm_active</span><span class="w"> </span><span class="n">Locked</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">is_locked</span><span class="w"> </span><span class="n">Unlocked</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">alarm_active</span><span class="w"> </span><span class="n">Unlocked</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">is_locked</span><span class="w"> </span><span class="n">LockedWithAlarm</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">alarm_active</span><span class="w"> </span><span class="n">LockedWithAlarm</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>

<span class="p">;</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">safety</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="n">violation</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="n">State</span><span class="p">)</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="ow">and</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">is_locked</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">alarm_active</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>
<span class="p">(</span><span class="n">check</span><span class="o">-</span><span class="n">sat</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">unsat</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">safety</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="n">holds</span><span class="o">!</span>
</code></pre></div>

<h4 id="property-4-liveness-properties">Property 4: Liveness Properties</h4>
<p><strong>Problem</strong>: Do we eventually reach a desired state?</p>
<p><strong>Cure Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">fsm</span><span class="w"> </span><span class="n">WorkflowState</span><span class="p">{</span><span class="n">tasks_completed</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">total_tasks</span><span class="o">:</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">Pending</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">start</span><span class="o">|</span><span class="w"> </span><span class="n">InProgress</span><span class="w"> </span><span class="p">{</span><span class="n">tasks_completed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span>
<span class="w">  </span><span class="n">InProgress</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">complete_task</span><span class="o">|</span><span class="w"> </span><span class="n">InProgress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">tasks_completed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tasks_completed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">InProgress</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">finish</span><span class="o">|</span><span class="w"> </span><span class="n">Completed</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">when</span><span class="w"> </span><span class="n">tasks_completed</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">total_tasks</span>
<span class="w">  </span><span class="p">}</span>
<span class="kd">end</span>

<span class="cp"># Liveness property: ◇Completed</span>
<span class="cp"># &quot;Eventually reach Completed state&quot;</span>
</code></pre></div>

<p><strong>Z3 Encoding</strong> (using bounded model checking):</p>
<div class="codehilite"><pre><span></span><code><span class="p">;</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">Completed</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">reachable</span><span class="w"> </span><span class="nx">within</span><span class="w"> </span><span class="nx">k</span><span class="w"> </span><span class="nx">steps</span>
<span class="p">(</span><span class="nx">declare</span><span class="o">-</span><span class="nx">datatypes</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">((</span><span class="nx">State</span><span class="w"> </span><span class="nx">Pending</span><span class="w"> </span><span class="nx">InProgress</span><span class="w"> </span><span class="nx">Completed</span><span class="p">)))</span>
<span class="p">(</span><span class="nx">declare</span><span class="o">-</span><span class="nx">fun</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="p">(</span><span class="nx">Int</span><span class="p">)</span><span class="w"> </span><span class="nx">State</span><span class="p">)</span>
<span class="p">(</span><span class="nx">declare</span><span class="o">-</span><span class="nx">fun</span><span class="w"> </span><span class="nx">tasks</span><span class="w"> </span><span class="p">(</span><span class="nx">Int</span><span class="p">)</span><span class="w"> </span><span class="nx">Int</span><span class="p">)</span>

<span class="p">;</span><span class="w"> </span><span class="nx">Initial</span><span class="w"> </span><span class="nx">state</span>
<span class="p">(</span><span class="nx">assert</span><span class="w"> </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="nx">Pending</span><span class="p">))</span>
<span class="p">(</span><span class="nx">assert</span><span class="w"> </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">tasks</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>

<span class="p">;</span><span class="w"> </span><span class="nx">Transition</span><span class="w"> </span><span class="nx">constraints</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">k</span><span class="p">=</span><span class="mi">10</span><span class="w"> </span><span class="nx">steps</span>
<span class="p">(</span><span class="nx">define</span><span class="o">-</span><span class="nx">fun</span><span class="w"> </span><span class="nx">transition</span><span class="w"> </span><span class="p">((</span><span class="nx">i</span><span class="w"> </span><span class="nx">Int</span><span class="p">))</span><span class="w"> </span><span class="nx">Bool</span>
<span class="w">  </span><span class="p">(</span><span class="k">or</span>
<span class="w">    </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="nx">Pending</span><span class="p">)</span>
<span class="w">         </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="nx">InProgress</span><span class="p">)</span>
<span class="w">         </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">tasks</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="nx">InProgress</span><span class="p">)</span>
<span class="w">         </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="nx">InProgress</span><span class="p">)</span>
<span class="w">         </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">tasks</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">tasks</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>
<span class="w">    </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="nx">InProgress</span><span class="p">)</span>
<span class="w">         </span><span class="p">(</span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="nx">tasks</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">         </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="nx">Completed</span><span class="p">))))</span>

<span class="p">;</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">Completed</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">reachable</span>
<span class="p">(</span><span class="nx">assert</span><span class="w"> </span><span class="p">(</span><span class="nx">exists</span><span class="w"> </span><span class="p">((</span><span class="nx">i</span><span class="w"> </span><span class="nx">Int</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">(=</span><span class="w"> </span><span class="p">(</span><span class="nx">state</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="nx">Completed</span><span class="p">))))</span>
<span class="p">(</span><span class="nx">check</span><span class="o">-</span><span class="nx">sat</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="nx">sat</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nx">liveness</span><span class="w"> </span><span class="nx">holds</span>
</code></pre></div>

<h4 id="property-5-data-invariants">Property 5: Data Invariants</h4>
<p><strong>Problem</strong>: Do data constraints always hold?</p>
<p><strong>Cure Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="n">record</span><span class="w"> </span><span class="n">CounterData</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">count</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>
<span class="w">  </span><span class="n">max_count</span><span class="p">:</span><span class="w"> </span><span class="n">Int</span>
<span class="n">end</span>

<span class="n">fsm</span><span class="w"> </span><span class="n">CounterData</span><span class="p">{</span><span class="n">count</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">max_count</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">}</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">Active</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">increment</span><span class="o">|</span><span class="w"> </span><span class="n">Active</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">when</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">max_count</span><span class="w">  </span><span class="c1"># Guard prevents overflow</span>
<span class="w">  </span><span class="p">}</span>
<span class="n">end</span>

<span class="c1"># Invariant: ∀ state. 0 &lt;= count &lt;= max_count</span>
</code></pre></div>

<p><strong>Z3 Verification</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">count_before</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">max_count</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">count_after</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>

<span class="p">;</span><span class="w"> </span><span class="n">Initial</span><span class="w"> </span><span class="n">invariant</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">count_before</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">max_count</span><span class="w"> </span><span class="mi">10</span><span class="p">))</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">count_before</span><span class="p">))</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;=</span><span class="w"> </span><span class="n">count_before</span><span class="w"> </span><span class="n">max_count</span><span class="p">))</span>

<span class="p">;</span><span class="w"> </span><span class="n">Transition</span><span class="w"> </span><span class="n">preserves</span><span class="w"> </span><span class="n">invariant</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="w"> </span><span class="n">count_before</span><span class="w"> </span><span class="n">max_count</span><span class="p">))</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">Guard</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">count_after</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="w"> </span><span class="n">count_before</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">Action</span>

<span class="p">;</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">invariant</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">transition</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="ow">or</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="w"> </span><span class="n">count_after</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">&gt;</span><span class="w"> </span><span class="n">count_after</span><span class="w"> </span><span class="n">max_count</span><span class="p">)))</span>
<span class="p">(</span><span class="n">check</span><span class="o">-</span><span class="n">sat</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">unsat</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">invariant</span><span class="w"> </span><span class="n">preserved</span><span class="o">!</span>
</code></pre></div>

<hr />
<h2 id="practical-examples">Practical Examples</h2>
<h3 id="example-1-verifying-refinement-types">Example 1: Verifying Refinement Types</h3>
<p>Cure supports refinement types (from <code>refinement_types.cure</code>):</p>
<div class="codehilite"><pre><span></span><code><span class="k">type</span><span class="w"> </span><span class="nx">Positive</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Int</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span>
<span class="k">type</span><span class="w"> </span><span class="nx">NonZero</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Int</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span>
<span class="k">type</span><span class="w"> </span><span class="nx">Percentage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Int</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="p">=&lt;</span><span class="w"> </span><span class="mi">100</span>

<span class="nx">def</span><span class="w"> </span><span class="nx">safe_divide</span><span class="p">(</span><span class="nx">a</span><span class="p">:</span><span class="w"> </span><span class="nx">Int</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">:</span><span class="w"> </span><span class="nx">NonZero</span><span class="p">):</span><span class="w"> </span><span class="nx">Int</span><span class="w"> </span><span class="p">=</span>
<span class="w">  </span><span class="nx">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">b</span>
</code></pre></div>

<p><strong>Z3 Verification of Type Safety</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>

<span class="p">;</span><span class="w"> </span><span class="n">Precondition</span><span class="p">:</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">NonZero</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="ow">not</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="mi">0</span><span class="p">)))</span>

<span class="p">;</span><span class="w"> </span><span class="n">Division</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">safe</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">(</span><span class="n">div</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">b</span><span class="p">)))</span>

<span class="p">;</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">division</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">possible</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="p">(</span><span class="n">check</span><span class="o">-</span><span class="n">sat</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">unsat</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">division</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">safe</span>
</code></pre></div>

<h3 id="example-2-verifying-fsm-transition-guards">Example 2: Verifying FSM Transition Guards</h3>
<div class="codehilite"><pre><span></span><code><span class="kd">record </span><span class="n">BankAccount</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">balance</span><span class="o">:</span><span class="w"> </span><span class="n">Int</span>
<span class="w">  </span><span class="n">overdraft_limit</span><span class="o">:</span><span class="w"> </span><span class="n">Int</span>
<span class="kd">end</span>

<span class="n">fsm</span><span class="w"> </span><span class="n">BankAccount</span><span class="p">{</span><span class="n">balance</span><span class="o">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="n">overdraft_limit</span><span class="o">:</span><span class="w"> </span><span class="mi">500</span><span class="p">}</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">Active</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">withdraw</span><span class="o">|</span><span class="w"> </span><span class="n">Active</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span>
<span class="w">    </span><span class="kr">when</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="o">-</span><span class="n">overdraft_limit</span>
<span class="w">  </span><span class="p">}</span>
<span class="kd">end</span>
</code></pre></div>

<p><strong>Z3 Verification</strong>: Prove balance never exceeds overdraft limit</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">balance_before</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">overdraft_limit</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">balance_after</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>

<span class="p">;</span><span class="w"> </span><span class="n">Initial</span><span class="w"> </span><span class="n">condition</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">balance_before</span><span class="w"> </span><span class="mi">1000</span><span class="p">))</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">overdraft_limit</span><span class="w"> </span><span class="mi">500</span><span class="p">))</span>

<span class="p">;</span><span class="w"> </span><span class="n">Transition</span><span class="w"> </span><span class="n">guard</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="w"> </span><span class="n">balance_before</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="w"> </span><span class="n">overdraft_limit</span><span class="p">)))</span>

<span class="p">;</span><span class="w"> </span><span class="n">Action</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">balance_after</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="w"> </span><span class="n">balance_before</span><span class="w"> </span><span class="n">amount</span><span class="p">)))</span>

<span class="p">;</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">invariant</span><span class="p">:</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="o">-</span><span class="n">overdraft_limit</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="w"> </span><span class="n">balance_after</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="w"> </span><span class="n">overdraft_limit</span><span class="p">)))</span>
<span class="p">(</span><span class="n">check</span><span class="o">-</span><span class="n">sat</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">unsat</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">invariant</span><span class="w"> </span><span class="n">holds</span>
</code></pre></div>

<h3 id="example-3-proving-equivalence-of-fsm-refactorings">Example 3: Proving Equivalence of FSM Refactorings</h3>
<p>Original FSM:</p>
<div class="codehilite"><pre><span></span><code><span class="n">fsm</span><span class="w"> </span><span class="n">TrafficLight1</span><span class="p">{...}</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">Red</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">Green</span>
<span class="w">  </span><span class="n">Green</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">Yellow</span>
<span class="w">  </span><span class="n">Yellow</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">Red</span>
<span class="kd">end</span>
</code></pre></div>

<p>Refactored FSM:</p>
<div class="codehilite"><pre><span></span><code><span class="n">fsm</span><span class="w"> </span><span class="n">TrafficLight2</span><span class="p">{...}</span><span class="w"> </span><span class="n">do</span>
<span class="w">  </span><span class="n">State0</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">State1</span>
<span class="w">  </span><span class="n">State1</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">State2</span>
<span class="w">  </span><span class="n">State2</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">timer</span><span class="o">|</span><span class="w"> </span><span class="n">State0</span>
<span class="kd">end</span>
</code></pre></div>

<p><strong>Z3 Verification</strong>: Prove both FSMs are isomorphic</p>
<div class="codehilite"><pre><span></span><code><span class="o">;</span><span class="w"> </span><span class="nt">Define</span><span class="w"> </span><span class="nt">mapping</span><span class="o">:</span><span class="w"> </span><span class="nt">Red</span><span class="w"> </span><span class="err">↔</span><span class="w"> </span><span class="nt">State0</span><span class="o">,</span><span class="w"> </span><span class="nt">Green</span><span class="w"> </span><span class="err">↔</span><span class="w"> </span><span class="nt">State1</span><span class="o">,</span><span class="w"> </span><span class="nt">Yellow</span><span class="w"> </span><span class="err">↔</span><span class="w"> </span><span class="nt">State2</span>
<span class="o">(</span><span class="nt">declare-fun</span><span class="w"> </span><span class="nt">map</span><span class="w"> </span><span class="o">(</span><span class="nt">State1</span><span class="o">)</span><span class="w"> </span><span class="nt">State2</span><span class="o">)</span>

<span class="o">(</span><span class="nt">assert</span><span class="w"> </span><span class="o">(=</span><span class="w"> </span><span class="o">(</span><span class="nt">map</span><span class="w"> </span><span class="nt">Red</span><span class="o">)</span><span class="w"> </span><span class="nt">State0</span><span class="o">))</span>
<span class="o">(</span><span class="nt">assert</span><span class="w"> </span><span class="o">(=</span><span class="w"> </span><span class="o">(</span><span class="nt">map</span><span class="w"> </span><span class="nt">Green</span><span class="o">)</span><span class="w"> </span><span class="nt">State1</span><span class="o">))</span>
<span class="o">(</span><span class="nt">assert</span><span class="w"> </span><span class="o">(=</span><span class="w"> </span><span class="o">(</span><span class="nt">map</span><span class="w"> </span><span class="nt">Yellow</span><span class="o">)</span><span class="w"> </span><span class="nt">State2</span><span class="o">))</span>

<span class="o">;</span><span class="w"> </span><span class="nt">Verify</span><span class="w"> </span><span class="nt">transitions</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">preserved</span>
<span class="o">(</span><span class="nt">assert</span><span class="w"> </span><span class="o">(=</span><span class="w"> </span><span class="o">(</span><span class="nt">map</span><span class="w"> </span><span class="o">(</span><span class="nt">transition1</span><span class="w"> </span><span class="nt">Red</span><span class="o">))</span><span class="w"> </span><span class="o">(</span><span class="nt">transition2</span><span class="w"> </span><span class="o">(</span><span class="nt">map</span><span class="w"> </span><span class="nt">Red</span><span class="o">))))</span>
<span class="o">;</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="o">(</span><span class="nt">similar</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nt">all</span><span class="w"> </span><span class="nt">transitions</span><span class="o">)</span>

<span class="o">(</span><span class="nt">check-sat</span><span class="o">)</span><span class="w">  </span><span class="o">;</span><span class="w"> </span><span class="nt">sat</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="nt">FSMs</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">equivalent</span>
</code></pre></div>

<h3 id="example-4-detecting-race-conditions-in-concurrent-fsms">Example 4: Detecting Race Conditions in Concurrent FSMs</h3>
<div class="codehilite"><pre><span></span><code><span class="n">record</span><span class="w"> </span><span class="n">SharedCounter</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="k">value</span><span class="o">:</span><span class="w"> </span><span class="kt">Int</span>
<span class="k">end</span>

<span class="n">fsm</span><span class="w"> </span><span class="n">Counter1</span><span class="err">{</span><span class="k">value</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="err">}</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">Idle</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">increment</span><span class="o">|</span><span class="w"> </span><span class="n">Idle</span><span class="w"> </span><span class="err">{</span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span>
<span class="k">end</span>

<span class="n">fsm</span><span class="w"> </span><span class="n">Counter2</span><span class="err">{</span><span class="k">value</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="err">}</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="n">Idle</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">increment</span><span class="o">|</span><span class="w"> </span><span class="n">Idle</span><span class="w"> </span><span class="err">{</span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="err">}</span>
<span class="k">end</span>

<span class="c1"># Both FSMs share the same `value` variable</span>
<span class="c1"># Can concurrent increments lead to lost updates?</span>
</code></pre></div>

<p><strong>Z3 Verification</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">value_initial</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">value_fsm1</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">value_fsm2</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>
<span class="p">(</span><span class="n">declare</span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">value_final</span><span class="w"> </span><span class="n">Int</span><span class="p">)</span>

<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">value_initial</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>

<span class="p">;</span><span class="w"> </span><span class="n">FSM1</span><span class="w"> </span><span class="n">increments</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">value_fsm1</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="w"> </span><span class="n">value_initial</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>

<span class="p">;</span><span class="w"> </span><span class="n">FSM2</span><span class="w"> </span><span class="n">increments</span><span class="w"> </span><span class="p">(</span><span class="n">reads</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">race</span><span class="p">)</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">value_fsm2</span><span class="w"> </span><span class="p">(</span><span class="o">+</span><span class="w"> </span><span class="n">value_initial</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span>

<span class="p">;</span><span class="w"> </span><span class="n">Final</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="p">(</span><span class="n">last</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">wins</span><span class="p">)</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="ow">or</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">value_final</span><span class="w"> </span><span class="n">value_fsm1</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">value_final</span><span class="w"> </span><span class="n">value_fsm2</span><span class="p">)))</span>

<span class="p">;</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="mi">2</span>
<span class="p">(</span><span class="nb">assert</span><span class="w"> </span><span class="p">(</span><span class="o">=</span><span class="w"> </span><span class="n">value_final</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<span class="p">(</span><span class="n">check</span><span class="o">-</span><span class="n">sat</span><span class="p">)</span><span class="w">  </span><span class="p">;</span><span class="w"> </span><span class="n">sat</span><span class="w"> </span><span class="err">→</span><span class="w"> </span><span class="n">race</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="n">detected</span><span class="o">!</span>
<span class="p">;</span><span class="w"> </span><span class="n">Model</span><span class="p">:</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">FSMs</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">wins</span>
</code></pre></div>

<hr />
<h2 id="integration-strategy">Integration Strategy</h2>
<h3 id="compile-time-verification">Compile-Time Verification</h3>
<p>Integrate Z3 into the Cure compiler pipeline:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">Cure</span><span class="w"> </span><span class="nv">Source</span><span class="w"> </span><span class="nv">Code</span>
<span class="w">      </span>│
<span class="w">      </span>▼
<span class="w">  </span><span class="nv">Lexer</span><span class="o">/</span><span class="nv">Parser</span>
<span class="w">      </span>│
<span class="w">      </span>▼
<span class="w">   </span><span class="nv">Type</span><span class="w"> </span><span class="nv">Checker</span><span class="w">  </span>◄───────┐
<span class="w">      </span>│<span class="w">                  </span>│
<span class="w">      </span>▼<span class="w">                  </span>│
<span class="w">  </span><span class="nv">FSM</span><span class="w"> </span><span class="nv">Analyzer</span><span class="w">           </span>│
<span class="w">      </span>│<span class="w">                  </span>│
<span class="w">      </span>▼<span class="w">                  </span>│
<span class="w"> </span><span class="nv">Generate</span><span class="w"> </span><span class="nv">Z3</span><span class="w"> </span><span class="nv">Queries</span><span class="w">     </span>│
<span class="w">      </span>│<span class="w">                  </span>│
<span class="w">      </span>▼<span class="w">                  </span>│
<span class="w">  </span><span class="nv">Z3</span><span class="w"> </span><span class="nv">Solver</span><span class="w">              </span>│
<span class="w">      </span>│<span class="w">                  </span>│
<span class="w">      </span>├──────────────────┘
<span class="w">      </span>│<span class="w"> </span><span class="ss">(</span><span class="nv">unsat</span><span class="w"> </span>→<span class="w"> </span><span class="nv">verify</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="nv">property</span><span class="ss">)</span>
<span class="w">      </span>▼
<span class="w"> </span><span class="nv">Report</span><span class="w"> </span><span class="nv">Errors</span><span class="o">/</span><span class="nv">Proofs</span>
<span class="w">      </span>│
<span class="w">      </span>▼
<span class="w">  </span><span class="nv">Code</span><span class="w"> </span><span class="nv">Generation</span>
</code></pre></div>

<h3 id="verification-workflow">Verification Workflow</h3>
<ol>
<li><strong>Extract FSM Structure</strong>: Parse FSM definitions, states, transitions, guards</li>
<li><strong>Generate Verification Conditions</strong>: Create Z3 queries for each property</li>
<li><strong>Invoke Z3</strong>: Check satisfiability of queries</li>
<li><strong>Report Results</strong>:<br />
   - <code>unsat</code> → Property holds ✓<br />
   - <code>sat</code> → Counterexample found ✗<br />
   - <code>unknown</code> → Timeout or undecidable</li>
</ol>
<h3 id="cure-compiler-integration-points">Cure Compiler Integration Points</h3>
<div class="codehilite"><pre><span></span><code><span class="c">%% In cure_fsm_verifier.erl</span>

<span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">verify_fsm</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">check_deadlock</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">check_safety</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">check_liveness</span><span class="o">/</span><span class="mi">2</span><span class="p">]).</span>

<span class="nf">verify_fsm</span><span class="p">(</span><span class="nv">FSM</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="c">%% Extract FSM structure</span>
<span class="w">    </span><span class="nv">States</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extract_states</span><span class="p">(</span><span class="nv">FSM</span><span class="p">),</span>
<span class="w">    </span><span class="nv">Transitions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extract_transitions</span><span class="p">(</span><span class="nv">FSM</span><span class="p">),</span>
<span class="w">    </span><span class="nv">Guards</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">extract_guards</span><span class="p">(</span><span class="nv">FSM</span><span class="p">),</span>

<span class="w">    </span><span class="c">%% Generate Z3 context</span>
<span class="w">    </span><span class="nv">Z3Context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">z3</span><span class="p">:</span><span class="nf">mk_context</span><span class="p">([]),</span>

<span class="w">    </span><span class="c">%% Encode FSM in Z3</span>
<span class="w">    </span><span class="nv">StateSort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">encode_states</span><span class="p">(</span><span class="nv">Z3Context</span><span class="p">,</span><span class="w"> </span><span class="nv">States</span><span class="p">),</span>
<span class="w">    </span><span class="nv">TransitionAssertions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">encode_transitions</span><span class="p">(</span><span class="nv">Z3Context</span><span class="p">,</span><span class="w"> </span><span class="nv">StateSort</span><span class="p">,</span><span class="w"> </span><span class="nv">Transitions</span><span class="p">),</span>

<span class="w">    </span><span class="c">%% Check properties</span>
<span class="w">    </span><span class="nv">DeadlockResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">check_deadlock</span><span class="p">(</span><span class="nv">Z3Context</span><span class="p">,</span><span class="w"> </span><span class="nv">StateSort</span><span class="p">,</span><span class="w"> </span><span class="nv">Transitions</span><span class="p">),</span>
<span class="w">    </span><span class="nv">SafetyResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">check_safety_properties</span><span class="p">(</span><span class="nv">Z3Context</span><span class="p">,</span><span class="w"> </span><span class="nv">FSM</span><span class="p">),</span>
<span class="w">    </span><span class="nv">LivenessResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">check_liveness_properties</span><span class="p">(</span><span class="nv">Z3Context</span><span class="p">,</span><span class="w"> </span><span class="nv">FSM</span><span class="p">),</span>

<span class="w">    </span><span class="c">%% Report</span>
<span class="w">    </span><span class="p">{</span><span class="nv">DeadlockResult</span><span class="p">,</span><span class="w"> </span><span class="nv">SafetyResult</span><span class="p">,</span><span class="w"> </span><span class="nv">LivenessResult</span><span class="p">}.</span>

<span class="nf">check_deadlock</span><span class="p">(</span><span class="nv">Z3Context</span><span class="p">,</span><span class="w"> </span><span class="nv">StateSort</span><span class="p">,</span><span class="w"> </span><span class="nv">Transitions</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="nv">Solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">z3</span><span class="p">:</span><span class="nf">mk_solver</span><span class="p">(</span><span class="nv">Z3Context</span><span class="p">),</span>

<span class="w">    </span><span class="c">%% For each state, check if it has outgoing transitions</span>
<span class="w">    </span><span class="nn">lists</span><span class="p">:</span><span class="nf">map</span><span class="p">(</span><span class="k">fun</span><span class="p">(</span><span class="nv">State</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="nv">HasTransition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">has_outgoing_transition</span><span class="p">(</span><span class="nv">State</span><span class="p">,</span><span class="w"> </span><span class="nv">Transitions</span><span class="p">),</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="nv">HasTransition</span><span class="w"> </span><span class="k">of</span>
<span class="w">            </span><span class="n">false</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="n">deadlock</span><span class="p">,</span><span class="w"> </span><span class="nv">State</span><span class="p">};</span>
<span class="w">            </span><span class="n">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ok</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">get_all_states</span><span class="p">(</span><span class="nv">StateSort</span><span class="p">)).</span>
</code></pre></div>

<h3 id="optimization-incremental-verification">Optimization: Incremental Verification</h3>
<p>For large FSMs, use Z3's <strong>incremental solving</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">verify_incremental</span><span class="p">(</span><span class="nv">FSM</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="nv">Z3Ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">z3</span><span class="p">:</span><span class="nf">mk_context</span><span class="p">([]),</span>
<span class="w">    </span><span class="nv">Solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">z3</span><span class="p">:</span><span class="nf">mk_solver</span><span class="p">(</span><span class="nv">Z3Ctx</span><span class="p">),</span>

<span class="w">    </span><span class="c">%% Add base constraints</span>
<span class="w">    </span><span class="nn">z3</span><span class="p">:</span><span class="nf">solver_assert</span><span class="p">(</span><span class="nv">Solver</span><span class="p">,</span><span class="w"> </span><span class="n">base_constraints</span><span class="p">(</span><span class="nv">FSM</span><span class="p">)),</span>

<span class="w">    </span><span class="c">%% Check properties incrementally</span>
<span class="w">    </span><span class="nn">lists</span><span class="p">:</span><span class="nf">map</span><span class="p">(</span><span class="k">fun</span><span class="p">(</span><span class="nv">Property</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="nn">z3</span><span class="p">:</span><span class="nf">solver_push</span><span class="p">(</span><span class="nv">Solver</span><span class="p">),</span><span class="w">  </span><span class="c">% Save state</span>
<span class="w">        </span><span class="nn">z3</span><span class="p">:</span><span class="nf">solver_assert</span><span class="p">(</span><span class="nv">Solver</span><span class="p">,</span><span class="w"> </span><span class="n">property_constraint</span><span class="p">(</span><span class="nv">Property</span><span class="p">)),</span>
<span class="w">        </span><span class="nv">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">z3</span><span class="p">:</span><span class="nf">solver_check</span><span class="p">(</span><span class="nv">Solver</span><span class="p">),</span>
<span class="w">        </span><span class="nn">z3</span><span class="p">:</span><span class="nf">solver_pop</span><span class="p">(</span><span class="nv">Solver</span><span class="p">),</span><span class="w">   </span><span class="c">% Restore state</span>
<span class="w">        </span><span class="p">{</span><span class="nv">Property</span><span class="p">,</span><span class="w"> </span><span class="nv">Result</span><span class="p">}</span>
<span class="w">    </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">properties_to_check</span><span class="p">(</span><span class="nv">FSM</span><span class="p">)).</span>
</code></pre></div>

<h3 id="ide-integration">IDE Integration</h3>
<p>Provide real-time verification feedback in development:</p>
<div class="codehilite"><pre><span></span><code><span class="err">┌─────────────────────────────────────────────┐</span>
<span class="err">│</span><span class="w"> </span><span class="n">fsm</span><span class="w"> </span><span class="n">DoorLock</span><span class="p">{...}</span><span class="w"> </span><span class="n">do</span><span class="w">                        </span><span class="err">│</span>
<span class="err">│</span><span class="w">   </span><span class="n">Locked</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">unlock</span><span class="o">|</span><span class="w"> </span><span class="n">Unlocked</span><span class="w">              </span><span class="err">│</span>
<span class="err">│</span><span class="w">   </span><span class="n">LockedWithAlarm</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="o">|</span><span class="n">unlock</span><span class="o">|</span><span class="w"> </span><span class="n">Unlocked</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="err">⚠️</span><span class="w"> </span><span class="n">Safety</span><span class="w"> </span><span class="n">violation</span>
<span class="err">│</span><span class="w">   </span><span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><span class="w">   </span><span class="err">│</span><span class="w">    </span><span class="n">Can</span><span class="w"> </span><span class="n">unlock</span><span class="w"> </span><span class="n">with</span>
<span class="err">│</span><span class="w">   </span><span class="n">Warning</span><span class="o">:</span><span class="w"> </span><span class="n">Violates</span><span class="w"> </span><span class="n">safety</span><span class="w"> </span><span class="n">property</span><span class="w">         </span><span class="err">│</span><span class="w">    </span><span class="n">alarm</span><span class="w"> </span><span class="n">active</span>
<span class="err">│</span><span class="w"> </span><span class="kd">end </span><span class="w">                                        </span><span class="err">│</span>
<span class="err">└─────────────────────────────────────────────┘</span>
</code></pre></div>

<h3 id="testing-and-verification-combined">Testing and Verification Combined</h3>
<p>Generate test cases from Z3 counterexamples:</p>
<div class="codehilite"><pre><span></span><code><span class="nf">generate_test_from_counterexample</span><span class="p">(</span><span class="nv">FSM</span><span class="p">,</span><span class="w"> </span><span class="nv">Property</span><span class="p">,</span><span class="w"> </span><span class="nv">Counterexample</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="c">%% Z3 provides: [Red, Green, Yellow, Failure]</span>
<span class="w">    </span><span class="nv">TestSteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">lists</span><span class="p">:</span><span class="nf">map</span><span class="p">(</span><span class="k">fun</span><span class="p">(</span><span class="nv">State</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">        </span><span class="nv">Event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_transition_event</span><span class="p">(</span><span class="nv">State</span><span class="p">,</span><span class="w"> </span><span class="nv">Counterexample</span><span class="p">),</span>
<span class="w">        </span><span class="p">{</span><span class="n">send_event</span><span class="p">,</span><span class="w"> </span><span class="nv">Event</span><span class="p">,</span><span class="w"> </span><span class="n">expect_state</span><span class="p">,</span><span class="w"> </span><span class="nv">State</span><span class="p">}</span>
<span class="w">    </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="nv">Counterexample</span><span class="p">),</span>

<span class="w">    </span><span class="c">%% Generate EUnit test</span>
<span class="w">    </span><span class="n">generate_eunit_test</span><span class="p">(</span><span class="nv">FSM</span><span class="p">,</span><span class="w"> </span><span class="nv">Property</span><span class="p">,</span><span class="w"> </span><span class="nv">TestSteps</span><span class="p">).</span>
</code></pre></div>

<hr />
<h2 id="further-reading">Further Reading</h2>
<h3 id="books">Books</h3>
<ol>
<li>
<p><strong>"Verification of Data-Aware Processes via Satisfiability Modulo Theories"</strong> by Alessandro Gianola<br />
   - Comprehensive treatment of SMT-based verification for stateful systems<br />
   - Covers reachability, safety, liveness, and deadlock detection<br />
   - Presents decision procedures and complexity results<br />
   - Essential reading for understanding Cure FSM verification</p>
</li>
<li>
<p><strong>"The Calculus of Computation"</strong> by Aaron R. Bradley and Zohar Manna<br />
   - Foundations of program verification<br />
   - SMT-based verification techniques<br />
   - Temporal logic and model checking</p>
</li>
<li>
<p><strong>"Decision Procedures"</strong> by Daniel Kroening and Ofer Strichman<br />
   - In-depth treatment of SAT and SMT algorithms<br />
   - Theory solvers and their combination<br />
   - Practical implementation details</p>
</li>
</ol>
<h3 id="papers">Papers</h3>
<ol>
<li>
<p><strong>"Z3: An Efficient SMT Solver"</strong> by Leonardo de Moura and Nikolaj Bjørner<br />
   - Architecture and algorithms of Z3<br />
   - Performance optimizations</p>
</li>
<li>
<p><strong>"Satisfiability Modulo Theories: Introduction and Applications"</strong> by Clark Barrett et al.<br />
   - Overview of SMT landscape<br />
   - Applications in verification</p>
</li>
<li>
<p><strong>"Temporal Verification of Reactive Systems: Safety"</strong> by Zohar Manna and Amir Pnueli<br />
   - Safety properties and their verification<br />
   - Temporal logic foundations</p>
</li>
</ol>
<h3 id="online-resources">Online Resources</h3>
<ol>
<li><strong>Z3 Tutorial</strong>: https://rise4fun.com/z3/tutorial</li>
<li><strong>SMT-LIB Standard</strong>: http://smtlib.cs.uiowa.edu/</li>
<li><strong>Z3 API Documentation</strong>: https://z3prover.github.io/api/html/</li>
<li><strong>Z3 GitHub Repository</strong>: https://github.com/Z3Prover/z3</li>
</ol>
<h3 id="related-tools">Related Tools</h3>
<ol>
<li><strong>Dafny</strong>: Verification-aware programming language using Z3</li>
<li><strong>CBMC</strong>: Bounded model checker for C/C++ using SAT/SMT</li>
<li><strong>Boogie</strong>: Intermediate verification language with Z3 backend</li>
<li><strong>Why3</strong>: Platform for deductive program verification with SMT support</li>
</ol>
<hr />
<h2 id="conclusion">Conclusion</h2>
<p>SMT solvers, particularly Z3, represent a transformative technology for ensuring software correctness. By integrating Z3 into the Cure compiler, we can:</p>
<ul>
<li><strong>Eliminate entire classes of bugs</strong> through compile-time verification</li>
<li><strong>Provide mathematical guarantees</strong> about FSM behavior</li>
<li><strong>Catch subtle errors</strong> that testing would miss</li>
<li><strong>Enable confident refactoring</strong> with equivalence proofs</li>
<li><strong>Generate high-quality test cases</strong> from counterexamples</li>
</ul>
<p>As Cure evolves, SMT-based verification will become increasingly valuable, especially for mission-critical systems where correctness is paramount. The combination of Cure's expressive type system, built-in FSMs, and Z3's powerful reasoning capabilities creates a uniquely robust platform for building reliable concurrent systems.</p>
<p>The insights from Gianola's "Verification of Data-Aware Processes via Satisfiability Modulo Theories" provide a solid theoretical foundation for implementing these verification techniques in Cure. By following the frameworks and algorithms presented in that work, we can build a world-class verification system that makes Cure a leader in verified systems programming for the BEAM.</p>
<hr />
<h2 id="references">References</h2>
<hr />
<p><em>For questions or contributions to Cure's verification infrastructure, please see the project repository and documentation.</em></p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p><a href="https://4m4.it/posts/satisfiability-modulo-theories-sudoku/index.html">Sudoku and Satisfiability Modulo Theories: Layman’s Example</a>&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p><a href="https://hanielbarbosa.com/papers/fm2024.pdf">Satisfiability Modulo Theories: A Beginner's Tutorial</a>&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>Alessandro Gianola, "SMT-based Safety Verification of Data-Aware Processes: Foundations and Applications," <a href="https://gianola.people.unibz.it/wp-content/uploads/2022/03/PhD-dissertation-Gianola.pdf">PDF</a>.&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:3" title="Jump back to footnote 3 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3:3" title="Jump back to footnote 3 in the text">&#8617;</a><a class="footnote-backref" href="#fnref4:3" title="Jump back to footnote 3 in the text">&#8617;</a><a class="footnote-backref" href="#fnref5:3" title="Jump back to footnote 3 in the text">&#8617;</a><a class="footnote-backref" href="#fnref6:3" title="Jump back to footnote 3 in the text">&#8617;</a><a class="footnote-backref" href="#fnref7:3" title="Jump back to footnote 3 in the text">&#8617;</a><a class="footnote-backref" href="#fnref8:3" title="Jump back to footnote 3 in the text">&#8617;</a><a class="footnote-backref" href="#fnref9:3" title="Jump back to footnote 3 in the text">&#8617;</a><a class="footnote-backref" href="#fnref10:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>Alessandro Gianola et al., “SMT-based Safety Verification of Data-Aware Processes,” CEUR Workshop Proceedings. <a href="https://ceur-ws.org/Vol-3216/paper_133.pdf">PDF</a>.&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 4 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:4" title="Jump back to footnote 4 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3:4" title="Jump back to footnote 4 in the text">&#8617;</a><a class="footnote-backref" href="#fnref4:4" title="Jump back to footnote 4 in the text">&#8617;</a><a class="footnote-backref" href="#fnref5:4" title="Jump back to footnote 4 in the text">&#8617;</a><a class="footnote-backref" href="#fnref6:4" title="Jump back to footnote 4 in the text">&#8617;</a><a class="footnote-backref" href="#fnref7:4" title="Jump back to footnote 4 in the text">&#8617;</a><a class="footnote-backref" href="#fnref8:4" title="Jump back to footnote 4 in the text">&#8617;</a><a class="footnote-backref" href="#fnref9:4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
</ol>
</div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Documentation</h4>
                <ul>
                    <li><a href="../docs.html">Getting Started</a></li>
                    <li><a href="language-spec.html">Language Specification</a></li>
                    <li><a href="type-system.html">Type System</a></li>
                    <li><a href="fsm-usage.html">FSM Guide</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>Reference</h4>
                <ul>
                    <li><a href="../api/index.html">API Reference</a></li>
                    <li><a href="std-summary.html">Standard Library</a></li>
                    <li><a href="feature-reference.html">Feature Reference</a></li>
                    <li><a href="cli-usage.html">CLI Usage</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h4>All Documentation</h4>
                <ul>
                    <li><a href="cli-integration-status.html">CLI Integration - SMT Solver Options and</a></li>
                    <li><a href="codegen-analysis-2025-11-25.html">Code Generation Issues - Analysis (2025-</a></li>
                    <li><a href="codegen-investigation-summary.html">Code Generation Issues - Investigation S</a></li>
                    <li><a href="contributing.html">Contributing</a></li>
                    <li><a href="api-reference.html">Cure API Reference</a></li>
                    <li><a href="fsm-api-design.html">Cure FSM API Design</a></li>
                    <li><a href="fsm-usage.html">Cure FSM Usage Guide</a></li>
                    <li><a href="lsp-mcp-update-2025-11-26.html">Cure LSP and MCP Update - November 26, 2</a></li>
                    <li><a href="lsp-smt-user-guide.html">Cure LSP with SMT Verification - User Gu</a></li>
                    <li><a href="feature-reference.html">Cure Language Features Reference</a></li>
                    <li><a href="language-spec.html">Cure Language Specification</a></li>
                    <li><a href="cure-syntax-guide.html">Cure Language Syntax Guide</a></li>
                    <li><a href="cure-ultimate-description.html">Cure Language: Ultimate Implementation D</a></li>
                    <li><a href="mcp-integration.html">Cure MCP Integration</a></li>
                    <li><a href="cli-usage.html">Cure Programming Language - Command Line</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 Cure Programming Language. Verification-first programming for the BEAM.</p>
        </div>
    </footer>

    <!-- Syntax Highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script src="../js/cure-language.js"></script>
    <script>
        // Initialize highlight.js and highlight all code blocks
        hljs.highlightAll();
    </script>
</body>
</html>
